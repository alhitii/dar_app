# โ ุฅุตูุงุญ ุฅุดุนุงุฑุงุช ุงูุบูุงุจ - ููุทุงูุจ ุงูุบุงุฆุจ ููุท

## โ ุงููุดููุฉ:

**ุฅุดุนุงุฑ ุงูุบูุงุจ ูุตู ูุฌููุน ุงูุทูุงุจ ุจุฏูุงู ูู ุงูุทุงูุจ ุงูุบุงุฆุจ ููุท!**

### ุงูุณุจุจ:

#### 1. ูู `send_absence_notification.dart`:
```dart
// โ ุงูููุฏ ุงููุฏูู
await FirebaseFirestore.instance.collection('notifications_admin').add({
  'studentUid': selectedStudentUid,
  'target': 'students',  // โ ูุฑุณู ูุฌููุน ุงูุทูุงุจ!
  'type': 'absence',
  ...
});
```

#### 2. ูู `home_screen.dart`:
```dart
// โ ุงูููุฏ ุงููุฏูู
final filteredDocs = snap.data!.docs.where((d) {
  final studentUid = (d.data()['studentUid'] ?? '').toString();
  final target = (d.data()['target'] ?? '').toString();
  
  if (studentUid.isNotEmpty && studentUid == uid) return true;  // โ ุตุญูุญ
  if (target == 'students' && userRole == 'student') return true;  // โ ุฎุทุฃ!
  
  return false;
}).toList();
```

**ุงููุชูุฌุฉ:**
- ุฅุดุนุงุฑ ุงูุบูุงุจ ูุญุชูู ุนูู `studentUid` (ุงูุทุงูุจ ุงูุบุงุฆุจ)
- ููู ุฃูุถุงู ูุญุชูู ุนูู `target: 'students'` 
- ุงูููุชุฑ ูุนุฑุถ ุงูุฅุดุนุงุฑ ูู:
  - โ ุงูุทุงูุจ ุงููุญุฏุฏ ุจู `studentUid`
  - โ **ุฌููุน ุงูุทูุงุจ** ูุฃู `target == 'students'`!

---

## โ ุงูุญู:

### 1. ุฅุฒุงูุฉ `target` ูู ุฅุดุนุงุฑุงุช ุงูุบูุงุจ

**ููู:** `lib/ui/admin/send_absence_notification.dart`

```dart
// โ ุงูููุฏ ุงูุฌุฏูุฏ
await FirebaseFirestore.instance.collection('notifications_admin').add({
  'studentUid': selectedStudentUid,  // โ ููุทุงูุจ ุงููุญุฏุฏ ููุท
  'studentName': selectedStudentName,
  'title': 'โ๏ธ ุชูุจูู ุบูุงุจ',
  'body': message,
  'date': date,
  // โ ุชู ุฅุฒุงูุฉ 'target': 'students'
  // โ ุงูุขู ูุนุชูุฏ ุนูู studentUid ููุท
  'type': 'absence',
  'expiresAt': Timestamp.fromDate(expiresAt),
  'createdAt': FieldValue.serverTimestamp(),
});
```

---

### 2. ุชุญุณูู ุงูููุชุฑ ูู `home_screen.dart`

**ููู:** `lib/ui/student/home_screen.dart`

```dart
// โ ุงูููุฏ ุงูุฌุฏูุฏ
final filteredDocs = snap.data!.docs.where((d) {
  final data = d.data();
  final target = (data['target'] ?? '').toString();
  final studentUid = (data['studentUid'] ?? '').toString();
  final type = (data['type'] ?? '').toString();
  
  // ุฅุดุนุงุฑุงุช ุงูุบูุงุจ: ููุทุงูุจ ุงููุญุฏุฏ ููุท โ
  if (type == 'absence') {
    return studentUid.isNotEmpty && studentUid == uid;
  }
  
  // ุฅุดุนุงุฑุงุช ูุญุฏุฏุฉ ูุทุงูุจ ูุนูู โ
  if (studentUid.isNotEmpty && studentUid == uid) {
    return true;
  }
  
  // ุฅุดุนุงุฑุงุช ุนุงูุฉ ูุฌููุน ุงูุทูุงุจ โ
  if (target == 'students' && userRole == 'student') {
    return true;
  }
  
  return false;
}).toList();
```

---

### 3. ุฅุถุงูุฉ Logging

```dart
print('๐ค ุฅุฑุณุงู ุฅุดุนุงุฑ ุบูุงุจ:');
print('   ุงูุทุงูุจ: $selectedStudentName');
print('   UID: $selectedStudentUid');
print('   ุงูุฑุณุงูุฉ: $message');
```

---

## ๐ ุงูููุงุฑูุฉ:

### โ ูุจู ุงูุฅุตูุงุญ:

```
ุงูุฅุฑุณุงู:
  โ studentUid: "abc123" (ุงูุทุงูุจ ุงูุบุงุฆุจ)
  โ target: "students" (ุฌููุน ุงูุทูุงุจ!)

ุงููุชูุฌุฉ:
  โ ุงูุทุงูุจ ุงูุบุงุฆุจ ูุฑู ุงูุฅุดุนุงุฑ
  โ ุฌููุน ุงูุทูุงุจ ุงูุขุฎุฑูู ูุฑูู ุงูุฅุดุนุงุฑ ุฃูุถุงู! (ุฎุทุฃ)
```

### โ ุจุนุฏ ุงูุฅุตูุงุญ:

```
ุงูุฅุฑุณุงู:
  โ studentUid: "abc123" (ุงูุทุงูุจ ุงูุบุงุฆุจ)
  โ type: "absence"
  โ ุชู ุฅุฒุงูุฉ target

ุงูููุชุฑ:
  โ if (type == 'absence'): ููุท ููุทุงูุจ ุงููุญุฏุฏ ุจู studentUid
  โ if (studentUid == uid): ุฅุดุนุงุฑุงุช ูุฎุตุตุฉ
  โ if (target == 'students'): ุฅุดุนุงุฑุงุช ุนุงูุฉ

ุงููุชูุฌุฉ:
  โ ุงูุทุงูุจ ุงูุบุงุฆุจ ููุท ูุฑู ุงูุฅุดุนุงุฑ
  โ ุงูุทูุงุจ ุงูุขุฎุฑูู ูุง ูุฑูู ุงูุฅุดุนุงุฑ
```

---

## ๐ฏ ููููุฉ ุงูุงุฎุชุจุงุฑ:

### ุงูุฎุทูุฉ 1: Hot Reload
```
ูู Terminalุ ุงูุชุจ: r
```

### ุงูุฎุทูุฉ 2: ุฅุฑุณุงู ุฅุดุนุงุฑ ุบูุงุจ
```
1. ุณุฌู ุฏุฎูู ูุฃุฏูู
2. ุงุฐูุจ ุฅูู "ุฅุฑุณุงู ุฅุดุนุงุฑ ุบูุงุจ"
3. ุงุฎุชุฑ:
   - ุงููุฑุญูุฉ: ูุชูุณุทุฉ
   - ุงูุตู: ุงูุซุงูู
   - ุงูุดุนุจุฉ: ุฃ
   - ุงูุทุงูุจ: ุฃุญูุฏ (ูุซูุงู)
4. ุงูุชุจ ุฑุณุงูุฉ: "ุชู ุชุณุฌูู ุบูุงุจู ุงูููู"
5. ุงุถุบุท "ุฅุฑุณุงู"
6. ุฑุงูุจ Console
```

**ูุฌุจ ุฃู ุชุฑู:**
```
๐ค ุฅุฑุณุงู ุฅุดุนุงุฑ ุบูุงุจ:
   ุงูุทุงูุจ: ุฃุญูุฏ
   UID: abc123xyz
   ุงูุฑุณุงูุฉ: ุชู ุชุณุฌูู ุบูุงุจู ุงูููู
โ ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ุงูุบูุงุจ ุจูุฌุงุญ
```

---

### ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงูุทุงูุจ ุงูุบุงุฆุจ
```
1. ุณุฌู ุฎุฑูุฌ
2. ุณุฌู ุฏุฎูู ุจุญุณุงุจ ุงูุทุงูุจ ุงูุบุงุฆุจ (ุฃุญูุฏ)
3. ูุฌุจ ุฃู ุชุฑู:
   - โ ุจุงูุฑ ุฃุญูุฑ "โ๏ธ ุชูุจูู ุบูุงุจ" ูู ุงูุฃุนูู
   - โ ุงูุฑุณุงูุฉ: "ุชู ุชุณุฌูู ุบูุงุจู ุงูููู"
```

---

### ุงูุฎุทูุฉ 4: ุงูุชุญูู ูู ุงูุทูุงุจ ุงูุขุฎุฑูู
```
1. ุณุฌู ุฎุฑูุฌ
2. ุณุฌู ุฏุฎูู ุจุญุณุงุจ ุทุงูุจ ุขุฎุฑ (ูุญูุฏ ูุซูุงู)
3. ูุฌุจ ุฃู ุชุฑู:
   - โ ูุง ููุฌุฏ ุจุงูุฑ ุบูุงุจ
   - โ ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ ุนุงุฏูุฉ
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก:

### ุฅุฐุง ุงุณุชูุฑ ุธููุฑ ุงูุฅุดุนุงุฑ ูุฌููุน ุงูุทูุงุจ:

#### ุงููุดููุฉ: ุฅุดุนุงุฑุงุช ูุฏููุฉ
```
ุงูุณุจุจ: ุฅุดุนุงุฑุงุช ุงูุบูุงุจ ุงููุฏููุฉ (ูุจู ุงูุฅุตูุงุญ) ูุง ุชุฒุงู ุชุญุชูู ุนูู target: 'students'
```

#### ุงูุญู:
```
1. ุงูุชุญ Firebase Console
2. Firestore Database
3. Collection: notifications_admin
4. ุงุจุญุซ ุนู ุฅุดุนุงุฑุงุช ุงูุบูุงุจ ุงููุฏููุฉ:
   - type: absence
   - target: students โ ุงุญุฐู ูุฐุง ุงูุญูู!
5. ุฃู ุงุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุฏููุฉ ูููุงู
6. ุฃุฑุณู ุฅุดุนุงุฑ ุฌุฏูุฏ (ุจุนุฏ ุงูุฅุตูุงุญ)
```

---

### ุฅุฐุง ูู ูุธูุฑ ุงูุฅุดุนุงุฑ ููุทุงูุจ ุงูุบุงุฆุจ:

#### ุงูุชุญูู ูู UID:
```
ูู Console ุนูุฏ ุชุณุฌูู ุฏุฎูู ุงูุทุงูุจ:
โ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ ูู Auth
   UID: abc123xyz  โ ุงูุณุฎ ูุฐุง

ูู Firestore:
notifications_admin โ [ุงูุฅุดุนุงุฑ] โ studentUid
ูุฌุจ ุฃู ูููู: abc123xyz  โ ููุณ UID!
```

---

## ๐ ููุงุญุธุงุช ูููุฉ:

### 1. ุฃูุงูู ุธููุฑ ุฅุดุนุงุฑ ุงูุบูุงุจ:

```
โ AbsenceBanner (ุจุงูุฑ ุฃุญูุฑ ูู ุงูุฃุนูู)
   - Collection: absences
   - Filter: where('studentUid', isEqualTo: uid)
   - ุงููุฏุฉ: 24 ุณุงุนุฉ ููุท
   - โ ูุนูู ุจุดูู ุตุญูุญ (ูุงู ูุนูู ูู ุงูุจุฏุงูุฉ)

โก notifications_admin (ููุญุฉ ุงูุฅุดุนุงุฑุงุช)
   - Collection: notifications_admin
   - Filter: ุญุณุจ type ู studentUid
   - ุงููุฏุฉ: ุณูุฉ ูุงููุฉ
   - โ ุชู ุฅุตูุงุญู (ูุงู ูุฑุณู ูุฌููุน ุงูุทูุงุจ)
```

### 2. ุฃููุงุน ุงูุฅุดุนุงุฑุงุช:

```
โ ุฅุดุนุงุฑ ุบูุงุจ (absence):
   - studentUid: "abc123"  โ ููุทุงูุจ ุงููุญุฏุฏ
   - type: "absence"
   - โ ุจุฏูู target

โก ุฅุดุนุงุฑ ุนุงู (announcement):
   - target: "students"  โ ูุฌููุน ุงูุทูุงุจ
   - type: "announcement"
   - โ ุจุฏูู studentUid

โข ุฅุดุนุงุฑ ูุฎุตุต (custom):
   - studentUid: "abc123"  โ ููุทุงูุจ ุงููุญุฏุฏ
   - type: "custom"
   - โ ุจุฏูู target
```

---

## โ ุงูุชุฃููุฏ ุงูููุงุฆู:

ุจุนุฏ ุงูุฅุตูุงุญุ ูุฌุจ ุฃู:

### ููุทุงูุจ ุงูุบุงุฆุจ:
```
โ ูุฑู ุจุงูุฑ ุฃุญูุฑ ูู ุงูุฃุนูู: "โ๏ธ ุชูุจูู ุบูุงุจ"
โ ูุฑู ุงูุฑุณุงูุฉ: "ุชู ุชุณุฌูู ุบูุงุจู ุงูููู"
โ ุงูุจุงูุฑ ูุธูุฑ ููุฏุฉ 24 ุณุงุนุฉ
โ ุงูุฅุดุนุงุฑ ูุธูุฑ ูู ููุญุฉ ุงูุฅุดุนุงุฑุงุช ููุฏุฉ ุณูุฉ
```

### ููุทูุงุจ ุงูุขุฎุฑูู:
```
โ ูุง ูุฑูู ุฃู ุจุงูุฑ ุบูุงุจ
โ ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ ุนุงุฏูุฉ
โ ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช ุบูุงุจ ูู ููุญุชูู
```

---

## ๐ ุงูุฎูุงุตุฉ:

### ุชู ุงูุฅุตูุงุญ:
1. โ ุฅุฒุงูุฉ `target: 'students'` ูู ุฅุดุนุงุฑุงุช ุงูุบูุงุจ
2. โ ุชุญุณูู ุงูููุชุฑ ูู `home_screen.dart`
3. โ ุฅุถุงูุฉ logging ููุชุดุฎูุต
4. โ ุฅุดุนุงุฑ ุงูุบูุงุจ ุงูุขู ููุทุงูุจ ุงูุบุงุฆุจ ููุท!

### ุงููููุงุช ุงููุนุฏูุฉ:
1. `lib/ui/admin/send_absence_notification.dart`
2. `lib/ui/student/home_screen.dart`

---

**๐ ุงูุขู ุฌุฑูุจ ุฅุฑุณุงู ุฅุดุนุงุฑ ุบูุงุจ ูุชุฃูุฏ ุฃูู ูุธูุฑ ููุทุงูุจ ุงูุบุงุฆุจ ููุท!**
