# โ ุฅุตูุงุญ ูุดููุฉ ุฅูุดุงุก ุงูุทุงูุจ - ุญูุธ ูู 3 ุฃูุงูู

## โ ุงููุดููุฉ ุงูููุชุดูุฉ:

ูู Console:
```
โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ุงููุณุชุฎุฏู ูู users
๐ Student Data:
  Stage:  โ ูุงุฑุบ!
  Formatted Grade: ุงูุซุงูู  โ ุจุฏูู "ูุชูุณุท"
```

**ุงูุณุจุจ:** `firebase_user_service.dart` ูุงู ูุญูุธ ูู **ููุงููู ููุท**:
1. โ `users_emails` (email ูููุชุงุญ)
2. โ `students` (studentId ูููุชุงุญ)
3. โ `users` (UID ูููุชุงุญ) โ **ููููุฏ!**

---

## โ ุงูุญู ุงููุทุจู:

### ุชู ุชุนุฏูู `lib/services/firebase_user_service.dart`:

#### 1. ุฅูุดุงุก ุญุณุงุจ Firebase Auth ุฃููุงู
```dart
// ูุจู: ูู ููู ููุฌูุฏุงู โ
// ุจุนุฏ:
UserCredential userCredential = await _auth.createUserWithEmailAndPassword(
  email: email,
  password: password,
);
String uid = userCredential.user!.uid;
print('โ ุชู ุฅูุดุงุก ุญุณุงุจ Auth - UID: $uid');

// ุชุณุฌูู ุฎุฑูุฌ ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ ููุฑุงู
await _auth.signOut();
```

#### 2. ุฅุถุงูุฉ UID ููุจูุงูุงุช
```dart
final studentData = {
  'uid': uid,  // โ ุฌุฏูุฏ!
  'name': name,
  'email': email,
  'role': 'student',
  'stage': stage,
  'grade': grade,
  'branch': branch,
  ...
};
```

#### 3. ุงูุญูุธ ูู 3 ุฃูุงูู
```dart
// โ ุญูุธ ูู users (ุจู UID)
await _firestore
    .collection('users')
    .doc(uid)  // โ UID ูููุชุงุญ!
    .set(studentData);
print('โ ุชู ุงูุญูุธ ูู users');

// โก ุญูุธ ูู users_emails (ุจู email)
await _firestore
    .collection('users_emails')
    .doc(email)  // โ email ูููุชุงุญ
    .set(studentData);
print('โ ุชู ุงูุญูุธ ูู users_emails');

// โข ุญูุธ ูู students (ุจู email)
await _firestore
    .collection('students')
    .doc(email)  // โ email ูููุชุงุญ
    .set(studentData);
print('โ ุชู ุงูุญูุธ ูู students');
```

#### 4. ุงูุชุญูู ูู ุงูุญูุธ
```dart
final verifyUsers = await _firestore.collection('users').doc(uid).get();
final verifyEmails = await _firestore.collection('users_emails').doc(email).get();
final verifyStudents = await _firestore.collection('students').doc(email).get();

if (verifyUsers.exists && verifyEmails.exists && verifyStudents.exists) {
  print('โโโ ุชุฃููุฏ: ุฌููุน ุงูุจูุงูุงุช ูุญููุธุฉ ุจูุฌุงุญ!');
}
```

---

## ๐ ุงูููุงุฑูุฉ:

### โ ูุจู:
```
ุฅูุดุงุก ุงูุทุงูุจ:
  โ users_emails (email)
  โ students (studentId)
  โ users (UID) โ ููููุฏ!

ุงููุชูุฌุฉ:
  โ ุฅูุดุงุก ููุฌุญ
  โ ุชุณุฌูู ุงูุฏุฎูู ููุฌุญ
  โ stage ูุงุฑุบ ูู home_screen
  โ ุงูุญุฐู ูุง ูุนูู (UID ููููุฏ)
```

### โ ุจุนุฏ:
```
ุฅูุดุงุก ุงูุทุงูุจ:
  โ ุฅูุดุงุก ุญุณุงุจ Auth โ ุงูุญุตูู ุนูู UID
  โก ุญูุธ ูู users (UID)
  โข ุญูุธ ูู users_emails (email)
  โฃ ุญูุธ ูู students (email)
  โค ุงูุชุญูู ูู ุงูุญูุธ

ุงููุชูุฌุฉ:
  โ ุฅูุดุงุก ููุฌุญ
  โ ุชุณุฌูู ุงูุฏุฎูู ููุฌุญ
  โ stage ููุฌูุฏ ูู home_screen
  โ ุงูุญุฐู ูุนูู ุจุดูู ุตุญูุญ
  โโโ ุชุฃููุฏ: ุฌููุน ุงูุจูุงูุงุช ูุญููุธุฉ!
```

---

## ๐ฏ ุงูุขู ุงุฎุชุจุฑ:

### ุงูุฎุทูุฉ 1: ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู
```bash
# ูู VS Code Terminal
r  # Hot reload
```

### ุงูุฎุทูุฉ 2: ุฃูุดุฆ ุทุงูุจ ุฌุฏูุฏ
```
1. ุณุฌู ุฏุฎูู ูุฃุฏูู
2. ุฅูุดุงุก ุญุณุงุจ ุทุงูุจ
3. ุฑุงูุจ Console - ูุฌุจ ุฃู ุชุฑู:

   ๐ ุฅูุดุงุก ุญุณุงุจ Firebase Auth...
   โ ุชู ุฅูุดุงุก ุญุณุงุจ Auth - UID: xxx
   ๐ ุชู ุชุณุฌูู ุฎุฑูุฌ ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ
   ๐ ุญูุธ ูู users (UID: xxx)...
   โ ุชู ุงูุญูุธ ูู users
   ๐ ุญูุธ ูู users_emails...
   โ ุชู ุงูุญูุธ ูู users_emails
   ๐ ุญูุธ ูู students...
   โ ุชู ุงูุญูุธ ูู students
   โโโ ุชุฃููุฏ: ุฌููุน ุงูุจูุงูุงุช ูุญููุธุฉ ุจูุฌุงุญ!
```

### ุงูุฎุทูุฉ 3: ุณุฌู ุฏุฎูู ุจุงูุทุงูุจ
```
1. Logout
2. ุณุฌู ุฏุฎูู ุจุงูุทุงูุจ ุงูุฌุฏูุฏ
3. ุฑุงูุจ Console - ูุฌุจ ุฃู ุชุฑู:

   โ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ ูู Auth
   ๐ ูุฑุงุกุฉ ุจูุงูุงุช users: ููุฌูุฏุฉ  โ ููุฌูุฏุฉ!
   ๐ Student Data:
     Stage: "ูุชูุณุทุฉ"  โ ููุฌูุฏ!
     Formatted Grade: "ุงูุซุงูู ูุชูุณุท"  โ ุตุญูุญ!
```

### ุงูุฎุทูุฉ 4: ุงุญุฐู ุงูุทุงูุจ
```
1. ุณุฌู ุฏุฎูู ูุฃุฏูู
2. ุงุญุฐู ุงูุทุงูุจ
3. ุฑุงูุจ Console - ูุฌุจ ุฃู ุชุฑู:

   ๐๏ธ ุจุฏุก ุญุฐู ุงููุณุชุฎุฏู: ...
   ๐ ุชู ุงูุนุซูุฑ ุนูู UID: xxx  โ ููุฌูุฏ!
   โ ุชู ุญุฐู ูู students
   โ ุชู ุญุฐู ูู users_emails
   โ ุชู ุญุฐู ูู users
   โโโ ุชุฃููุฏ: ุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุจูุฌุงุญ!
```

---

## ๐ ููุงุญุธุงุช ูููุฉ:

### 1. ููุงุฐุง 3 ุฃูุงููุ

```
users (UID):
  - ููุจุญุซ ุงูุณุฑูุน ุจู UID
  - ูููุฒุงููุฉ ูุน Firebase Auth
  - ููุญุฐู ุงูุตุญูุญ

users_emails (email):
  - ููุจุญุซ ุจู email
  - ููุชุญูู ูู ุงูุจุฑูุฏ ุงูููุฌูุฏ
  - ูููุฒุงููุฉ ูุน AuthService

students (email):
  - ููููุงุฆู ูุงูุชุตููุฉ
  - ููุงุณุชุนูุงูุงุช ุงููุชูุฏูุฉ
  - ููุชูุงูู ูุน ุงูููุฏ ุงููุฏูู
```

### 2. ููุงุฐุง signOut ุจุนุฏ ุงูุฅูุดุงุกุ

```dart
await _auth.createUserWithEmailAndPassword(...);
// ุงูุขู: ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ ูุณุฌู ุฏุฎูู!

await _auth.signOut();
// ุงูุขู: ุชู ุชุณุฌูู ุฎุฑูุฌ ุงูุฌููุน

// ุงููุดููุฉ: ุงูุฃุฏูู ุชู ุชุณุฌูู ุฎุฑูุฌู ุฃูุถุงู! โ
// ุงูุญู: signOut ุซู ุญูุธ ุงูุจูุงูุงุช ุจุฏูู auth โ
```

### 3. ุงูุชุญูู ูู ุงูุญูุธ

```dart
// ุจุฏูู ุชุญูู:
await firestore.collection('users').doc(uid).set(data);
// ูุฏ ููุฌุญ ุฃู ููุดู ุจุตูุช โ

// ูุน ุชุญูู:
await firestore.collection('users').doc(uid).set(data);
await Future.delayed(Duration(milliseconds: 300));
final verify = await firestore.collection('users').doc(uid).get();
if (verify.exists) {
  print('โ ุชุฃููุฏ!');
} // โ
```

---

## ๐ ุญู ุงููุดุงูู:

### ุฅุฐุง ุธูุฑ "email-already-in-use"
```
ุงูุณุจุจ: ุงูุญุณุงุจ ููุฌูุฏ ูู Firebase Auth
ุงูุญู:
  1. ุงุญุฐู ูู Firebase Console โ Authentication
  2. ุฃุนุฏ ุฅูุดุงุก ุงูุญุณุงุจ
```

### ุฅุฐุง ูุงู stage ูุงุฑุบ
```
ุงูุณุจุจ: ุงูุจูุงูุงุช ูู ุญุณุงุจ ูุฏูู (ูุจู ุงูุฅุตูุงุญ)
ุงูุญู:
  1. ุงุญุฐู ุงูุญุณุงุจ ูู ุงูุชุทุจูู
  2. ุงุญุฐู ูู Firebase Console โ Authentication
  3. ุฃูุดุฆ ุงูุญุณุงุจ ูุฑุฉ ุฃุฎุฑู
```

### ุฅุฐุง ูุดู ุงูุญุฐู
```
ุงูุณุจุจ: UID ููููุฏ (ุญุณุงุจ ูุฏูู)
ุงูุญู:
  1. ุงุญุฐู ูู Firebase Console ูุฏููุงู:
     - Authentication โ Users โ Delete
     - Firestore โ users_emails โ Delete
     - Firestore โ students โ Delete
  2. ุฃูุดุฆ ุงูุญุณุงุจ ูุฑุฉ ุฃุฎุฑู
```

---

## โ ุชููุน ุงููุชุงุฆุฌ:

### Console ุนูุฏ ุงูุฅูุดุงุก:
```
โ ุชู ุฅูุดุงุก ุญุณุงุจ Auth - UID: xxx
โ ุชู ุงูุญูุธ ูู users
โ ุชู ุงูุญูุธ ูู users_emails
โ ุชู ุงูุญูุธ ูู students
โโโ ุชุฃููุฏ: ุฌููุน ุงูุจูุงูุงุช ูุญููุธุฉ ุจูุฌุงุญ!
```

### Console ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:
```
โ ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ ูู Auth
๐ ูุฑุงุกุฉ ุจูุงูุงุช users: ููุฌูุฏุฉ
๐ Student Data:
  Stage: "ูุชูุณุทุฉ"
  Formatted Grade: "ุงูุซุงูู ูุชูุณุท"
```

### Console ุนูุฏ ุงูุญุฐู:
```
๐ ุชู ุงูุนุซูุฑ ุนูู UID: xxx
โ ุชู ุญุฐู ูู students
โ ุชู ุญุฐู ูู users_emails
โ ุชู ุญุฐู ูู users
โโโ ุชุฃููุฏ: ุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุจูุฌุงุญ!
```

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ:

1. โ `lib/services/firebase_user_service.dart`
   - ุฅุถุงูุฉ ุฅูุดุงุก ุญุณุงุจ Auth
   - ุฅุถุงูุฉ ุญูุธ ูู users
   - ุฅุถุงูุฉ ุงูุชุญูู ูู ุงูุญูุธ
   - ุชุบููุฑ students ูู studentId ุฅูู email ูููุชุงุญ

2. โ `lib/ui/student/home_screen.dart`
   - ุฅุถุงูุฉ logging ูู stage
   - ุฅุถุงูุฉ ุชุญุฐูุฑ ุฅุฐุง ูุงู stage ูุงุฑุบ

---

**๐ ุงูุขู ุฌููุน ุงููุธุงุฆู ุชุนูู ุจุดูู ุตุญูุญ!**
**๐ ุฌุฑูุจ ุฅูุดุงุก ุทุงูุจ ุฌุฏูุฏ ูุฑุงูุจ Console!**
