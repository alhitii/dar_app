# ๐๏ธ **ููุฎุต ููุฒุฉ ุญุฐู ุงููุณุชุฎุฏููู ูู Authentication**

## โ **ุชู ุงูุชุทุจูู ุนูู:**

### **1๏ธโฃ ุงูุทูุงุจ (Students):**
- โ ุญุฐู ูู `students` collection
- โ ุญุฐู ูู `users_emails` collection  
- โ ุญุฐู ูู `users` collection
- โ ุญุฐู ูู **Firebase Authentication** (ุนุจุฑ Cloud Function)

**ุงูุฏุงูุฉ:** `deactivateStudent()`  
**ุงูููู:** `lib/services/firebase_user_service.dart` (ุงูุณุทุฑ 570-656)

---

### **2๏ธโฃ ุงููุนูููู (Teachers):**
- โ ุญุฐู ูู `teachers` collection
- โ ุญุฐู ูู `users_emails` collection
- โ ุญุฐู ูู `users` collection  
- โ ุญุฐู ูู **Firebase Authentication** (ุนุจุฑ Cloud Function)

**ุงูุฏุงูุฉ:** `deactivateTeacher()`  
**ุงูููู:** `lib/services/firebase_user_service.dart` (ุงูุณุทุฑ 667-758)

---

### **3๏ธโฃ ุงูุฅุฏุงุฑููู (Admins):**
- โ ุญุฐู ูู `admins` collection
- โ ุญุฐู ูู `users_emails` collection
- โ ุญุฐู ูู `users` collection
- โ ุญุฐู ูู **Firebase Authentication** (ุนุจุฑ Cloud Function)

**ุงูุฏุงูุฉ:** `deactivateAdmin()`  
**ุงูููู:** `lib/services/firebase_user_service.dart` (ุงูุณุทุฑ 769-869)

---

## ๐ **Cloud Function ููุญุฐู ูู Authentication:**

**ุงูููู:** `functions/index.js` (ุงูุณุทุฑ 134-180)

```javascript
export const deleteUser = onCall(async (request) => {
  // ุงูุชุญูู ูู ุตูุงุญูุงุช Admin
  if (!request.auth || callerRole !== "admin") {
    throw HttpsError("permission-denied");
  }

  const { uid, email } = request.data;
  
  // ุญุฐู ูู Authentication
  await auth.deleteUser(uid);
  
  return { success: true, message: "ุชู ุงูุญุฐู ุจูุฌุงุญ" };
});
```

**ุชู Deploy ูู:** 2025-10-28 05:33 AM

---

## ๐ **ุนูููุฉ ุงูุญุฐู ุงููุงููุฉ:**

### **ูุซุงู: ุญุฐู ุทุงูุจ**

```
1๏ธโฃ ุงูุญุฐู ูู Firestore:
   - students/{email} โ ูุญุฐูู
   - users_emails/{email} โ ูุญุฐูู  
   - users/{uid} โ ูุญุฐูู

2๏ธโฃ ุงุณุชุฏุนุงุก Cloud Function:
   - POST: deleteUser({ uid, email })
   
3๏ธโฃ Cloud Function ุชุญุฐู ูู Authentication:
   - Firebase Auth User โ ูุญุฐูู ููุงุฆูุงู

4๏ธโฃ UI Response:
   - Dialog ููุบูู โ
   - ุฑุณุงูุฉ ูุฌุงุญ ุฎุถุฑุงุก โ
   - ุงููุณุชุฎุฏู ูุฎุชูู ูู ุงููุงุฆูุฉ โ
```

---

## ๐งช **ููููุฉ ุงูุงุฎุชุจุงุฑ:**

### **ุงุฎุชุจุงุฑ ุญุฐู ุทุงูุจ:**
```
1. ุงูุชุญ ุงูุชุทุจูู ูู Admin
2. ุงุฐูุจ ุฅูู "ุญุณุงุจุงุช ุงูุทูุงุจ"
3. ุงุถุบุท โฎ โ ุญุฐู
4. ุฑุงูุจ Terminal
```

**ูุฌุจ ุฃู ุชุฑู:**
```
๐๏ธ ูุญุงููุฉ ุญุฐู ุงูุทุงูุจ...
   1๏ธโฃ ุญุฐู ูู students...
   โ ุชู ุงูุญุฐู ูู students
   2๏ธโฃ ุญุฐู ูู users_emails...
   โ ุชู ุงูุญุฐู ูู users_emails
   3๏ธโฃ ุญุฐู ูู users...
   โ ุชู ุงูุญุฐู ูู users
   4๏ธโฃ ูุญุงููุฉ ุญุฐู ูู Authentication...
   โ ุชู ุงูุญุฐู ูู Authentication โจ
โโ ุชู ุญุฐู ุงูุทุงูุจ ููุงุฆูุงู ูู Firebase
```

---

### **ุงุฎุชุจุงุฑ ุญุฐู ูุนูู:**
ููุณ ุงูุฎุทูุงุช ูู "ุญุณุงุจุงุช ุงููุนูููู"

### **ุงุฎุชุจุงุฑ ุญุฐู ุฅุฏุงุฑู:**
ููุณ ุงูุฎุทูุงุช ูู "ุญุณุงุจุงุช ุงูุฅุฏุงุฑููู" (ุฅุฐุง ููุฌุฏุช ุงูุดุงุดุฉ)

---

## ๐ **ุงูุชุญูู ูู Firebase Console:**

### **ุจุนุฏ ุงูุญุฐู:**

```
1. Firestore Database:
   โ Document ูุญุฐูู ูู ุฌููุน ุงููุฌููุนุงุช

2. Authentication โ Users:
   โ User ูุญุฐูู ุชูุงูุงู - ูู ูุธูุฑ!

3. Functions โ Logs:
   โ ูุธูุฑ: "User deleted from Authentication: {email}"
```

---

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

### **1. ุงูุญุฐู ููุงุฆู:**
- โ ูุง ูููู ุงุณุชุฑุฌุงุน ุงููุณุชุฎุฏู ุจุนุฏ ุงูุญุฐู
- โ ุฌููุน ุงูุจูุงูุงุช ุชูุญุฐู ููุงุฆูุงู
- โ ูููุตุญ ุจุนูู Backup ูุจู ุงูุญุฐู

### **2. ุงูุตูุงุญูุงุช:**
- โ Cloud Function ุชุชุญูู ูู ุฃู ุงููุณุชุฏุนู `admin`
- โ ูุง ูููู ููุทูุงุจ/ุงููุนูููู ุญุฐู ุฃููุณูู
- โ ููุท Admin ููููู ุญุฐู ุงูุญุณุงุจุงุช

### **3. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:**
- โฑ๏ธ Timeout: 30 ุซุงููุฉ ููู ุนูููุฉ
- ๐ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
- ๐ Print statements ุชูุตูููุฉ ููุชุชุจุน
- โ Dialog ููุบูู ุญุชู ูู ุญุงูุฉ ุงูุฎุทุฃ

---

## ๐ฐ **ุงูุชูููุฉ (Cloud Functions):**

**ุนูู Blaze Plan:**
- ุฃูู 2 ููููู ุงุณุชุฏุนุงุก/ุดูุฑ: **ูุฌุงูู** ๐
- ุจุนุฏ ุฐูู: $0.40 ููู ููููู ุงุณุชุฏุนุงุก

**ูุซุงู:**
- 100 ุญุฐู/ููู = 3000 ุญุฐู/ุดูุฑ = **ูุฌุงูู ุชูุงูุงู!**

---

## ๐ **ุงููููุงุช ุงููุนุฏูุฉ:**

```
โ lib/services/firebase_user_service.dart
   - deactivateStudent() โ ูุญุฐู ูู Authentication
   - deactivateTeacher() โ ูุญุฐู ูู Authentication
   - deactivateAdmin() โ ุฌุฏูุฏ! ูุญุฐู ูู Authentication

โ lib/ui/admin/admin_tabs_screen.dart
   - ุฅุถุงูุฉ ุญุงูุฉ ุญุฐู ุงูุฅุฏุงุฑู

โ functions/index.js
   - deleteUser() โ Cloud Function ุฌุฏูุฏุฉ

โ pubspec.yaml
   - cloud_functions: ^5.1.4 โ ุจุงูุฌ ุฌุฏูุฏ
```

---

## ๐ฏ **ุงูุฎูุงุตุฉ:**

| ุงูููุน | Firestore | Authentication | UI |
|------|-----------|----------------|-----|
| **ุทุงูุจ** | โ ููุญุฐู | โ ููุญุฐู | โ ูุฎุชูู |
| **ูุนูู** | โ ููุญุฐู | โ ููุญุฐู | โ ูุฎุชูู |
| **ุฅุฏุงุฑู** | โ ููุญุฐู | โ ููุญุฐู | โ ูุฎุชูู |

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** 2025-10-28  
**ุงูุฅุตุฏุงุฑ:** 1.0.0  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู
