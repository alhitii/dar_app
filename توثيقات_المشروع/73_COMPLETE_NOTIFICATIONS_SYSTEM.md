# โ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงููุงูู

## ๐ **ุงูุชุงุฑูุฎ:** 1 ููููุจุฑ 2025

---

## ๐ฏ **ุงููุธุงู ุงูููุงุฆู:**

### **ุตูุญุฉ ุงูุชูุจููุงุช (inbox_screen.dart):**

ุชุนุฑุถ 3 ุฃููุงุน ูู ุงูุฅุดุนุงุฑุงุช:

```
1. ุฅุดุนุงุฑุงุช ุงูุฅุฏุงุฑุฉ (announcements) - ููุฏุฉ ุณูุฉ
2. ุฅุดุนุงุฑุงุช ูุจุงุดุฑุฉ (notifications) - ุฏุงุฆูุฉ
3. ุฅุดุนุงุฑุงุช ุงูุบูุงุจ (notifications_absences) - ููุฏุฉ ุณูุฉ
```

---

## ๐ **ูุตุงุฏุฑ ุงูุฅุดุนุงุฑุงุช:**

### **1๏ธโฃ ุฅุดุนุงุฑุงุช ุงูุฅุฏุงุฑุฉ (announcements):**

**ุงููุตุฏุฑ:** `send_admin_announcement_screen.dart`

**ุงูุจูุงูุงุช:**
```javascript
{
  title: "ุนููุงู ุงูุฅุดุนุงุฑ",
  message: "ูุต ุงูุฅุดุนุงุฑ",
  targetRole: "all" | "student" | "teacher",
  type: "info" | "success" | "warning" | "error",
  timestamp: Timestamp,
  expiresAt: Timestamp (ุณูุฉ),
  bannerExpiresAt: Timestamp (24 ุณุงุนุฉ),
  isActive: true
}
```

**ุงูููุชุฑุฉ:**
- ุญุณุจ `targetRole` (all, student, teacher)
- ุญุณุจ `expiresAt` (ููุฏุฉ ุณูุฉ)

---

### **2๏ธโฃ ุฅุดุนุงุฑุงุช ูุจุงุดุฑุฉ (notifications):**

**ุงููุตุฏุฑ:** ุฅุดุนุงุฑุงุช ูุฎุตุตุฉ ููุณุชุฎุฏู ูุนูู

**ุงูุจูุงูุงุช:**
```javascript
{
  recipientId: "uid",
  title: "ุนููุงู",
  body: "ูุต",
  type: "homework" | "announcement" | etc,
  createdAt: Timestamp,
  read: false
}
```

---

### **3๏ธโฃ ุฅุดุนุงุฑุงุช ุงูุบูุงุจ (notifications_absences):**

**ุงููุตุฏุฑ:** `send_absence_screen.dart`

**ุงูุจูุงูุงุช:**
```javascript
{
  studentUid: "uid",
  studentName: "ุงูุงุณู",
  message: "ุฑุณุงูุฉ ุงูุบูุงุจ",
  date: Timestamp,
  createdAt: Timestamp,
  bannerExpiresAt: Timestamp (24 ุณุงุนุฉ),
  archiveUntil: Timestamp (ุณูุฉ),
  read: false,
  type: 'absence'
}
```

---

## ๐ **ููู ูุนูู:**

### **ูู inbox_screen.dart:**

```dart
Future<List<Map<String, dynamic>>> _loadAllNotifications(String? uid, DateTime now) async {
  final allNotifications = [];
  
  // 1. ุชุญุฏูุฏ ุฏูุฑ ุงููุณุชุฎุฏู
  final userDoc = await FirebaseFirestore.instance
      .collection('students')
      .doc(uid)
      .get();
  final userRole = userDoc.exists ? 'student' : 'teacher';
  
  // 2. ุชุญููู ุฅุดุนุงุฑุงุช ุงูุฅุฏุงุฑุฉ (announcements)
  final announcements = await FirebaseFirestore.instance
      .collection('announcements')
      .where('expiresAt', isGreaterThan: Timestamp.fromDate(now))
      .orderBy('expiresAt', descending: true)
      .get();
  
  for (var doc in announcements.docs) {
    final targetRole = doc.data()['targetRole'];
    if (targetRole == 'all' || targetRole == userRole) {
      allNotifications.add({
        'title': doc.data()['title'],
        'body': doc.data()['message'],
        'type': doc.data()['type'],
        'source': 'announcement',
      });
    }
  }
  
  // 3. ุชุญููู ุฅุดุนุงุฑุงุช ูุจุงุดุฑุฉ (notifications)
  final notifications = await FirebaseFirestore.instance
      .collection('notifications')
      .where('recipientId', isEqualTo: uid)
      .get();
  
  allNotifications.addAll(notifications.docs);
  
  // 4. ุชุญููู ุฅุดุนุงุฑุงุช ุงูุบูุงุจ (ููุทูุงุจ ููุท)
  if (userRole == 'student') {
    final absences = await FirebaseFirestore.instance
        .collection('notifications_absences')
        .where('studentUid', isEqualTo: uid)
        .where('archiveUntil', isGreaterThan: Timestamp.fromDate(now))
        .get();
    
    allNotifications.addAll(absences.docs);
  }
  
  // 5. ุชุฑุชูุจ ุญุณุจ ุงูุชุงุฑูุฎ
  allNotifications.sort((a, b) => 
    b['createdAt'].compareTo(a['createdAt'])
  );
  
  return allNotifications;
}
```

---

## ๐จ **ุงูุฃููููุงุช ูุงูุฃููุงู:**

### **ุฃููุงุน ุงูุฅุดุนุงุฑุงุช:**

| ุงูููุน | ุงูุฃููููุฉ | ุงูููู |
|-------|----------|-------|
| homework | ๐ assignment | ุฃุฒุฑู |
| absence | โ๏ธ warning_amber | ุฃุญูุฑ |
| announcement | ๐ข campaign | ุจุฑุชูุงูู |
| info | โน๏ธ info | ุฃุฒุฑู |
| success | โ check_circle | ุฃุฎุถุฑ |
| warning | โ๏ธ warning | ุจุฑุชูุงูู |
| error | โ error | ุฃุญูุฑ |

---

## ๐ฑ **ูุงุฌูุฉ ุงููุณุชุฎุฏู:**

### **ุตูุญุฉ ุงูุชูุจููุงุช:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ุงูุชูุจููุงุช                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ ุฅุดุนุงุฑ ุฅุฏุงุฑู                     โ
โ ุชู ุชุญุฏูุซ ุฌุฏูู ุงูุงูุชุญุงูุงุช...        โ
โ ููุฐ ุณุงุนุฉ                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ ุฅุดุนุงุฑ ุบูุงุจ                      โ
โ ุบุงุจ ุงูุทุงูุจ ููู ุงูุฃุญุฏ...            โ
โ ููุฐ ุณุงุนุชูู                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โน๏ธ ุฅุดุนุงุฑ ุฅุฏุงุฑู                     โ
โ ุงุฌุชูุงุน ุฃูููุงุก ุงูุฃููุฑ...            โ
โ ููุฐ 3 ุณุงุนุงุช                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## โฐ **ุงููุฏุฉ:**

| ุงูููุน | ุงููุฏุฉ ูู ุงูุจุงูุฑ | ุงููุฏุฉ ูู ุงูุชูุจููุงุช |
|-------|-----------------|-------------------|
| ุฅุดุนุงุฑุงุช ุงูุฅุฏุงุฑุฉ | 24 ุณุงุนุฉ | ุณูุฉ |
| ุฅุดุนุงุฑุงุช ูุจุงุดุฑุฉ | - | ุฏุงุฆูุฉ |
| ุฅุดุนุงุฑุงุช ุงูุบูุงุจ | 24 ุณุงุนุฉ | ุณูุฉ |

---

## ๐ **ุงููููุงุช ุงููุนุฏูุฉ:**

```
โ lib/ui/student/inbox_screen.dart
   - ุชุญููู ุฅูู StatefulWidget
   - ุฅุถุงูุฉ _loadAllNotifications()
   - ุชุญููู ูู 3 ูุตุงุฏุฑ
   - ููุชุฑุฉ ุญุณุจ ุงูุฏูุฑ
   - ุชุฑุชูุจ ุญุณุจ ุงูุชุงุฑูุฎ
   - ุฏุนู ุฌููุน ุฃููุงุน ุงูุฅุดุนุงุฑุงุช

โ lib/ui/admin/send_admin_announcement_screen.dart
   - ุฅุถุงูุฉ expiresAt (ุณูุฉ)
   - ุฅุถุงูุฉ bannerExpiresAt (24 ุณุงุนุฉ)
```

---

## ๐งช **ููุงุฎุชุจุงุฑ:**

### **ูู Admin:**
```
1. ุงูุชุญ "ุฅุฑุณุงู ุชูุจูู ุฅุฏุงุฑู"
2. ุงุฎุชุฑ ููุน ุงูุฅุดุนุงุฑ (info, success, warning, error)
3. ุงุฎุชุฑ ุงููุฆุฉ ุงููุณุชูุฏูุฉ (ุงูุฌููุนุ ุทูุงุจุ ูุนูููู)
4. ุงูุชุจ ุงูุนููุงู ูุงูุฑุณุงูุฉ
5. ุงุถุบุท ุฅุฑุณุงู
```

### **ูู ุทุงูุจ:**
```
1. ุงูุชุญ "ุงูุชูุจููุงุช"
2. ูุฌุจ ุฃู ุชุฑู:
   - ุฅุดุนุงุฑุงุช ุงูุฅุฏุงุฑุฉ (ุฅุฐุง ูุงูุช ููุทูุงุจ ุฃู ุงูุฌููุน)
   - ุฅุดุนุงุฑุงุช ุงูุบูุงุจ (ููุฏุฉ ุณูุฉ)
   - ุฅุดุนุงุฑุงุช ูุจุงุดุฑุฉ (ุฅู ูุฌุฏุช)
3. ุงููู ูุฑุชุจ ุญุณุจ ุงูุชุงุฑูุฎ
```

### **ูู ูุนูู:**
```
1. ุงูุชุญ "ุงูุชูุจููุงุช"
2. ูุฌุจ ุฃู ุชุฑู:
   - ุฅุดุนุงุฑุงุช ุงูุฅุฏุงุฑุฉ (ุฅุฐุง ูุงูุช ูููุนูููู ุฃู ุงูุฌููุน)
   - ุฅุดุนุงุฑุงุช ูุจุงุดุฑุฉ (ุฅู ูุฌุฏุช)
3. ูุง ูุฑู ุฅุดุนุงุฑุงุช ุงูุบูุงุจ (ุฎุงุตุฉ ุจุงูุทูุงุจ)
```

---

## ๐ฏ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:**

```
โ ูุธุงู ุฅุดุนุงุฑุงุช ูุงูู ููุชูุงูู
โ 3 ูุตุงุฏุฑ ููุฅุดุนุงุฑุงุช
โ ููุชุฑุฉ ุญุณุจ ุงูุฏูุฑ
โ ููุชุฑุฉ ุญุณุจ ุงููุฏุฉ
โ ุฃููููุงุช ูุฃููุงู ูููุฒุฉ
โ ุชุฑุชูุจ ุฒููู
โ ูุงุฌูุฉ ููุญุฏุฉ
```

---

**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ูููุชูู
