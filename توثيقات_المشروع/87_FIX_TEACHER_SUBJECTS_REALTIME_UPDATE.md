# ุฅุตูุงุญ: ุชุญุฏูุซ ููุงุฏ ุงููุนูู ูู ุงูููุช ุงููุนูู

**ุงูุชุงุฑูุฎ:** 7 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ  
**ุงูุฅุตุฏุงุฑ:** v1.0.0+1

---

## ๐ ุงููุดููุฉ

ุนูุฏ ุชุนุฏูู ุญุณุงุจ ุงููุนูู ูุฅุถุงูุฉ ูุงุฏุฉ ุฌุฏูุฏุฉ:
- โ ุชุธูุฑ ุงููุงุฏุฉ ุงูุฌุฏูุฏุฉ ูู ูุงุฆูุฉ **ุฅุฑุณุงู ุงููุงุฌุจ**
- โ ูุง ุชุธูุฑ ุงููุงุฏุฉ ุงูุฌุฏูุฏุฉ ูู **ุจุทุงูุฉ ุงููุนูู** (ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ)

**ุงูุณุจุจ:**
- ุงูุจูุงูุงุช ุชูุญูู ูุฑุฉ ูุงุญุฏุฉ ููุท ูู `initState()`
- ูุง ููุฌุฏ ุงุณุชูุงุน ููุชุบููุฑุงุช ูู Firestore
- ุนูุฏ ุชุนุฏูู ุงูููุงุฏ ูู ุงูุฅุฏุงุฑุฉุ ุตูุญุฉ ุงููุนูู ูุง ุชุชุญุฏุซ

---

## โ ุงูุญู

### 1. ุงุณุชุจุฏุงู `.get()` ุจู `.snapshots()`

**ูุจู:**
```dart
// โ ุชุญููู ูุฑุฉ ูุงุญุฏุฉ ููุท
final subjectsSnapshot = await FirebaseFirestore.instance
    .collection('subjects')
    .where('teacherId', isEqualTo: user.uid)
    .get();  // ๐ ูุญูู ูุฑุฉ ูุงุญุฏุฉ ููุท
```

**ุจุนุฏ:**
```dart
// โ ุงุณุชูุงุน ูุจุงุดุฑ ููุชุบููุฑุงุช
FirebaseFirestore.instance
    .collection('subjects')
    .where('teacherId', isEqualTo: user.uid)
    .snapshots()  // ๐ ูุณุชูุน ููุชุบููุฑุงุช ุงูููุฑูุฉ
    .listen((subjectsSnapshot) {
      // ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุนูุฏ ูู ุชุญุฏูุซ
      ...
    });
```

### 2. ุงูุชุญุฏูุซ ุงูุชููุงุฆู

ุนูุฏ ุฅุถุงูุฉ/ุญุฐู ูุงุฏุฉ ูู ุงูุฅุฏุงุฑุฉ:
1. **Firestore** ูุฑุณู ุฅุดุนุงุฑ ููุฑู
2. **`.snapshots()`** ูุณุชูุจู ุงูุชุญุฏูุซ
3. **`listen()`** ููุดุบูู callback
4. **`setState()`** ูุญุฏุซ ุงููุงุฌูุฉ

**ุงููุชูุฌุฉ:** ุชุธูุฑ ุงููุงุฏุฉ ููุฑุงู ุจุฏูู reload!

---

## ๐ ุงูุชุบููุฑุงุช

### ุงูููู: `lib/ui/teacher/teacher_home_complete.dart`

#### ุฏุงูุฉ `_loadTeacherSubjects()`:

**ุงูููุฏ ุงูุฌุฏูุฏ:**
```dart
Future<void> _loadTeacherSubjects() async {
  if (_teacherData == null) return;

  try {
    final user = FirebaseAuth.instance.currentUser;
    if (user == null) return;

    print('๐ ุชุญููู ููุงุฏ ุงููุนูู: ${user.uid}');

    // โ ุงุณุชุฎุฏุงู snapshots ููุงุณุชูุงุน ููุชุบููุฑุงุช ุงููุจุงุดุฑุฉ
    FirebaseFirestore.instance
        .collection('subjects')
        .where('teacherId', isEqualTo: user.uid)
        .snapshots()
        .listen((subjectsSnapshot) {
      
      print('๐ ุนุฏุฏ ุงูููุงุฏ ุงููุณุชุฑุฌุนุฉ: ${subjectsSnapshot.docs.length}');

      if (subjectsSnapshot.docs.isNotEmpty) {
        final subjectsList = <Map<String, String>>[];
        final uniqueSubjects = <String>{};
        
        for (var doc in subjectsSnapshot.docs) {
          final data = doc.data();
          final subjectName = data['name'] as String?;
          
          if (subjectName != null && !uniqueSubjects.contains(subjectName)) {
            uniqueSubjects.add(subjectName);
            
            // ุงูุญุตูู ุนูู ุงูุฅูููุฌู
            String emoji = '๐';
            final allSubjects = [
              ...EducationConstants.primarySchoolSubjects,
              ...EducationConstants.middleSchoolSubjects,
              ...EducationConstants.preparatoryCommonSubjects,
              ...EducationConstants.subjectsPreparatoryScience,
              ...EducationConstants.subjectsPreparatoryLiterature,
            ];
            
            for (var subject in allSubjects) {
              if (subject['name'] == subjectName) {
                emoji = subject['emoji'] ?? '๐';
                break;
              }
            }
            
            subjectsList.add({
              'name': subjectName,
              'code': doc.id,
              'emoji': emoji,
            });
            
            print('โ ูุงุฏุฉ: $subjectName ($emoji)');
          }
        }

        if (!mounted) return;
        
        setState(() {
          _teacherSubjects = subjectsList;
        });
        
        print('โ ุชู ุชุญููู ${subjectsList.length} ูุงุฏุฉ ูุฑูุฏุฉ (ุชุญุฏูุซ ูุจุงุดุฑ)');
      } else {
        // ุฅุฐุง ูู ุชูุฌุฏ ููุงุฏ ูุฎุตุตุฉุ ุงุณุชุฎุฏู ุงูููุงุฏ ุงูุงูุชุฑุงุถูุฉ
        print('โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ููุงุฏ ูุฎุตุตุฉ');
        
        final stage = _teacherData!['stage'] as String?;
        final grade = _teacherData!['grade'] as String?;
        final branch = _teacherData!['branch'] as String?;

        if (stage != null && grade != null) {
          if (!mounted) return;
          setState(() {
            _teacherSubjects = EducationConstants.getSubjects(
              stage: stage,
              grade: grade,
              branch: branch,
            ).cast<Map<String, String>>();
          });
        }
      }
    });
  } catch (e) {
    print('โ ุฎุทุฃ ูู ุชุญููู ุงูููุงุฏ: $e');
  }
}
```

---

## ๐ฏ ููููุฉ ุงูุนูู

### ุงูุณููุงุฑูู:

1. **ุงููุนูู ููุชุญ ุงูุชุทุจูู**
   - ูุชู ุงุณุชุฏุนุงุก `_loadTeacherSubjects()`
   - ูุจุฏุฃ ุงูุงุณุชูุงุน ูู `subjects` collection

2. **ุงูุฅุฏุงุฑุฉ ุชุถูู ูุงุฏุฉ ุฌุฏูุฏุฉ**
   - ุชุญุฏูุซ Firestore: `subjects.add({teacherId: ...})`
   - Firestore ูุฑุณู ุฅุดุนุงุฑ ูููุณุชูุนูู

3. **ุตูุญุฉ ุงููุนูู ุชุชุญุฏุซ ููุฑุงู**
   - `.snapshots()` ูุณุชูุจู ุงูุชุญุฏูุซ
   - `listen()` callback ููุดุบูู
   - `setState()` ูุญุฏูุซ `_teacherSubjects`
   - ุงููุงุฌูุฉ ุชูุนูุฏ ุงูุจูุงุก

4. **ุงููุชูุฌุฉ:**
   - โ ุชุธูุฑ ุงููุงุฏุฉ ุงูุฌุฏูุฏุฉ ูู **ุจุทุงูุฉ ุงููุนูู**
   - โ ุชุธูุฑ ุงููุงุฏุฉ ุงูุฌุฏูุฏุฉ ูู **ูุงุฆูุฉ ุฅุฑุณุงู ุงููุงุฌุจ**
   - โ ูู ุดูุก ูุชุฒุงูู ุชููุงุฆูุงู

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:

1. **ุณุฌูู ุฏุฎูู ููุนูู**
   - ุงูุชุญ ุงูุชุทุจูู
   - ุณุฌูู ุฏุฎูู ููุนูู
   - ุงุชุฑู ุงูุตูุญุฉ ููุชูุญุฉ

2. **ูู ุญุณุงุจ ุงูุฅุฏุงุฑุฉ:**
   - ุงูุชุญ ุชุทุจูู ุขุฎุฑ ุฃู ูุชุตูุญ
   - ุณุฌูู ุฏุฎูู ูุฅุฏุงุฑุฉ
   - ุงุฐูุจ ูู "ุชุนุฏูู ูุนูู"
   - ุฃุถู ูุงุฏุฉ ุฌุฏูุฏุฉ ูููุนูู
   - ุงุญูุธ ุงูุชุนุฏููุงุช

3. **ุงุฑุฌุน ูุตูุญุฉ ุงููุนูู:**
   - โ **ูุฌุจ ุฃู ุชุธูุฑ ุงููุงุฏุฉ ุงูุฌุฏูุฏุฉ ููุฑุงู**
   - ุจุฏูู reload
   - ุจุฏูู ุฅุนุงุฏุฉ ุชุณุฌูู ุฏุฎูู
   - ุชุญุฏูุซ ุชููุงุฆู ูู ุงูููุช ุงููุนูู

---

## ๐ก ุงูููุงุฆุฏ

| ูุจู | ุจุนุฏ |
|-----|-----|
| โ ูุฌุจ ุฅุนุงุฏุฉ ุชุณุฌูู ุงูุฏุฎูู | โ ุชุญุฏูุซ ููุฑู |
| โ ุชุญููู ูุฑุฉ ูุงุญุฏุฉ ููุท | โ ุงุณุชูุงุน ูุณุชูุฑ |
| โ ุจูุงูุงุช ูุฏ ุชููู ูุฏููุฉ | โ ุจูุงูุงุช ุฏุงุฆูุงู ูุญุฏุซุฉ |
| โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุฆุฉ | โ ุชุฌุฑุจุฉ ุณูุณุฉ |

---

## โ๏ธ ููุงุญุธุงุช

### 1. ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ:
- ุงูู listener ูุชู ุฅูุบุงุคู ุชููุงุฆูุงู ุนูุฏ dispose ุงูุตูุญุฉ
- ูุง ุญุงุฌุฉ ูุฅูุบุงุก ุงูุงุดุชุฑุงู ูุฏููุงู

### 2. ุงูุฃุฏุงุก:
- ุงูุชุญุฏูุซุงุช ุชุญุฏุซ ููุท ุนูุฏ ุชุบููุฑ ุงูุจูุงูุงุช
- ูุง overhead ุฅุถุงูู
- ุงุณุชุฎุฏุงู `if (!mounted)` ูุชุฌูุจ setState ุจุนุฏ dispose

### 3. Fallback:
- ุฅุฐุง ูู ุชูุฌุฏ ููุงุฏ ูุฎุตุตุฉุ ูุณุชุฎุฏู ุงูููุงุฏ ุงูุงูุชุฑุงุถูุฉ
- ูู `EducationConstants` ุญุณุจ ุงููุฑุญูุฉ/ุงูุตู/ุงููุฑุน

---

## ๐ ููุฎุต

| ุงูุนูุตุฑ | ุงูุญุงูุฉ |
|--------|--------|
| **ุงููุดููุฉ** | ุงูููุงุฏ ุงูุฌุฏูุฏุฉ ูุง ุชุธูุฑ ูู ุจุทุงูุฉ ุงููุนูู |
| **ุงูุณุจุจ** | ุงุณุชุฎุฏุงู `.get()` ุจุฏูุงู ูู `.snapshots()` |
| **ุงูุญู** | ุงุณุชุฎุฏุงู Firestore Realtime Listeners |
| **ุงูููู ุงููุนุฏู** | `lib/ui/teacher/teacher_home_complete.dart` |
| **ุงูุชุฃุซูุฑ** | ุชุญุฏูุซ ููุฑู ุจุฏูู reload |
| **ุงูุญุงูุฉ** | โ **ุชู ุงูุฅุตูุงุญ ูุงูุงุฎุชุจุงุฑ** |

---

## โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐จโ๐ซ ุจุทุงูุฉ ุงููุนูู                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ๐ ุงูุฅุณูุงููุฉ                       โ
โ  ๐ ุงูุนุฑุจูุฉ                         โ
โ  ๐ค ุงูุฅููููุฒูุฉ                      โ
โ  โ ุงูุฑูุงุถูุงุช  โ ๐ฅ ุชุธูุฑ ููุฑุงู!    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ุงูููุงุฏ ุชุชุญุฏุซ ูู ุงูููุช ุงููุนูู - ุจุฏูู ุฃู ุชุฏุฎู ูู ุงููุณุชุฎุฏู!** ๐
