# ๐ฏ ุงูุฅุตูุงุญ ุงูุดุงูู ุงูููุงุฆู - ุงููุฑุงุฌุนุฉ ุงููุงููุฉ

## ๐ **ุงูุชุงุฑูุฎ:** 2 ููููุจุฑ 2025

---

## โ๏ธ **ุงููุดุงูู ุงููุชุจููุฉ:**

```
โ ุงูุฅุดุนุงุฑุงุช: ูุง ุตูุช ููุง ุงูุชุฒุงุฒ
โ ุฃุณูุงุก ุงููุนูููู: ูุง ุชุธูุฑ ูู ุจุนุถ ุงูููุงุฏ
```

---

## ๐ง **ุงูุฅุตูุงุญุงุช ุงูููุงุฆูุฉ:**

### **1. ุฅุตูุงุญ FCM Token (ุงูุฅุดุนุงุฑุงุช):**

#### **ุงููุดููุฉ:**
```dart
// ูู notification_service.dart (main.dart)
await _firebaseMessaging?.getToken();
final user = FirebaseAuth.instance.currentUser; // โ null! ูู ูุณุฌู ุฏุฎูู ุจุนุฏ

// ูู login_screen_new.dart
await FirebaseFirestore.instance
    .collection('users')
    .doc(user.uid)
    .update({'fcmToken': token}); // โ ููุดู ุฅุฐุง ูู ููู document ููุฌูุฏ
```

#### **ุงูุญู:**
```dart
// ูู login_screen_new.dart (ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู ูุจุงุดุฑุฉ)
final token = await FirebaseMessaging.instance.getToken();

// โ ุงุณุชุฎุฏุงู set ูุน merge ุจุฏูุงู ูู update
await FirebaseFirestore.instance
    .collection('users')
    .doc(userCredential.user!.uid)
    .set({'fcmToken': token}, SetOptions(merge: true)); // โ ูุนูู ุฏุงุฆูุงู

// โ ุญูุธ ูู students/teachers/admins ุฃูุถุงู
await FirebaseFirestore.instance
    .collection(role + 's') // students, teachers, admins
    .doc(userCredential.user!.uid)
    .set({'fcmToken': token}, SetOptions(merge: true));
```

---

### **2. ุฅุตูุงุญ ุฃุณูุงุก ุงููุนูููู:**

#### **ุงููุดููุฉ:**
```dart
// ุงูููุฏ ุงููุฏูู
final teacherName = data['teacherName']; // โ ูุฏ ูููู null
if (teacherName != null) {
  names[subjectName] = teacherName;
}
// โ ุฅุฐุง ูุงู nullุ ูุง ูุถูู ุดูุก โ "ุบูุฑ ูุญุฏุฏ"
```

#### **ุงูุญู:**
```dart
// ุงูููุฏ ุงูุฌุฏูุฏ (ุฐูู ููุฑู)
final teacherName = data['teacherName'];
final teacherId = data['teacherId'];

if (teacherName != null && teacherName.isNotEmpty) {
  // โ ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู teacherName ูุจุงุดุฑุฉ
  names[subjectName] = teacherName;
}
else if (teacherId != null && teacherId.isNotEmpty) {
  // โ ุงูุทุฑููุฉ 2: ุฌูุจ ูู users ุจุงุณุชุฎุฏุงู teacherId
  final teacherDoc = await FirebaseFirestore.instance
      .collection('users')
      .doc(teacherId)
      .get();
  
  if (teacherDoc.exists) {
    final name = teacherDoc.data()?['name'];
    if (name != null && name.isNotEmpty) {
      names[subjectName] = name;
    }
  }
}
```

---

## ๐ **ุงูููุงุฑูุฉ ุงูุดุงููุฉ:**

### **ูุจู ุงูุฅุตูุงุญ:**
```
โ FCM Token:
   - ููุญูุธ ูู main() ูุจู ุชุณุฌูู ุงูุฏุฎูู
   - user = null
   - update() ููุดู ุฅุฐุง ูู ููู document ููุฌูุฏ
   - Token ูุง ููุญูุธ ูู Firestore
   
โ ุฃุณูุงุก ุงููุนูููู:
   - ูุนุชูุฏ ุนูู teacherName ููุท
   - ุฅุฐุง ูุงู null โ "ุบูุฑ ูุญุฏุฏ"
   - ูุง ูุญุงูู ุฌูุจ ูู users
   
โ ุงููุชูุฌุฉ:
   - ุงูุฅุดุนุงุฑุงุช ูุง ุชุตู
   - ุฃุณูุงุก ุงููุนูููู ูุง ุชุธูุฑ
```

### **ุจุนุฏ ุงูุฅุตูุงุญ:**
```
โ FCM Token:
   - ููุญูุธ ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู ูุจุงุดุฑุฉ
   - user ููุฌูุฏ
   - set() ูุน merge ูุนูู ุฏุงุฆูุงู
   - Token ููุญูุธ ูู users ู students/teachers/admins
   
โ ุฃุณูุงุก ุงููุนูููู:
   - ูุญุงูู teacherName ุฃููุงู
   - ุฅุฐุง ูุงู nullุ ูุฌูุจ ูู users
   - ูุนูู ูู ุฌููุน ุงูุญุงูุงุช
   
โ ุงููุชูุฌุฉ:
   - ุงูุฅุดุนุงุฑุงุช ุชุตู ูุน ุตูุช ูุงูุชุฒุงุฒ
   - ุฃุณูุงุก ุงููุนูููู ุชุธูุฑ ุฌููุนูุง
```

---

## ๐ **ููู ูุนูู ุงููุธุงู ุงูุขู:**

### **1. ุชุณุฌูู ุงูุฏุฎูู:**
```
1. ุงููุณุชุฎุฏู ูุฏุฎู email ู password
2. Firebase Auth ูุณุฌู ุงูุฏุฎูู โ
3. ุฌูุจ role ูู Firestore โ
4. ุฌูุจ FCM Token โ
5. ุญูุธ Token ูู:
   - users/{uid}/fcmToken โ
   - students/{uid}/fcmToken (ููุทูุงุจ) โ
   - teachers/{uid}/fcmToken (ูููุนูููู) โ
6. ุงูุงูุชูุงู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ โ
```

### **2. ุฅุฑุณุงู ูุงุฌุจ:**
```
1. ุงููุนูู ูุฑุณู ูุงุฌุจ โ Firestore/homework โ
2. Function "notifyStudentsOnHomework" ุชูุดุบูู โ
3. Function ุชุฌูุจ FCM Tokens ูู users โ
4. Function ุชุฑุณู FCM ููุทูุงุจ โ
5. ุงูุทูุงุจ ูุณุชูุจููู ูุน:
   ๐ ุตูุช (ูู Android channel)
   ๐ณ ุงูุชุฒุงุฒ (ูู Android channel)
   ๐ ุฅุดุนุงุฑ ูู ุดุฑูุท ุงูุฅุดุนุงุฑุงุช
   ๐ด ุงูุดุงุฑุฉ ุงูุญูุฑุงุก ุชุธูุฑ ููุฑุงู
```

### **3. ุนุฑุถ ุงูููุงุฏ:**
```
1. ุงูุทุงูุจ ููุชุญ ุงูุชุทุจูู โ
2. _loadTeacherNames() ุชูุณุชุฏุนู โ
3. ุฌูุจ ุฌููุน ุงูููุงุฏ ูู subjects โ
4. ููู ูุงุฏุฉ:
   - ุฅุฐุง ูุงู teacherName ููุฌูุฏ โ ุงุณุชุฎุฏุงูู โ
   - ุฅุฐุง ูู ููู ููุฌูุฏ โ ุฌูุจ ูู users ุจุงุณุชุฎุฏุงู teacherId โ
5. ุนุฑุถ "ุฃ : [ุงุณู ุงููุนูู]" โ
```

---

## ๐งช **ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ ุงูุดุงููุฉ:**

### **1. ุชุซุจูุช APK:**
```
๐ฑ build\app\outputs\flutter-apk\app-release.apk
```

### **2. ุงุฎุชุจุงุฑ FCM Token:**
```
1. ุซุจูุช APK
2. ุณุฌู ุฏุฎูู ูุทุงูุจ
3. ุชุญูู ูู Console logs:
   โ "๐ FCM Token: ey..."
   โ "โ FCM Token saved successfully in users and student"
4. ุชุญูู ูู Firestore:
   - users/{uid}/fcmToken โ ููุฌูุฏ
   - students/{uid}/fcmToken โ ููุฌูุฏ
```

### **3. ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช:**
```
ุฌูุงุฒ 1 (ูุนูู):
1. ุณุฌู ุฏุฎูู ููุนูู
2. ุฃุฑุณู ูุงุฌุจ ุฌุฏูุฏ

ุฌูุงุฒ 2 (ุทุงูุจ):
1. โ ุงูุฅุดุนุงุฑ ูุตู ููุฑุงู (ุจุฏูู ุฅุนุงุฏุฉ ูุชุญ!)
2. โ ุงูุตูุช ูุนูู ๐
3. โ ุงูุงูุชุฒุงุฒ ูุนูู ๐ณ
4. โ ุงูุดุงุฑุฉ ุงูุญูุฑุงุก ุชุธูุฑ ููุฑุงู ๐ด
5. โ ุงูุฅุดุนุงุฑ ูู ุดุฑูุท ุงูุฅุดุนุงุฑุงุช
```

### **4. ุงุฎุชุจุงุฑ ุฃุณูุงุก ุงููุนูููู:**
```
1. ุณุฌู ุฏุฎูู ูุทุงูุจ
2. ุงูุธุฑ ุฅูู ูุงุฆูุฉ ุงูููุงุฏ
3. ุชุญูู ูู Console logs:
   โ "ุชู ุชุญููู X ุงุณู ูุนูู ูู Y ูุงุฏุฉ"
   โ "ุฌูุจ ุงุณู ุงููุนูู ูู users: [ุงููุงุฏุฉ] โ [ุงูุงุณู]"
4. โ ุฌููุน ุงูููุงุฏ ุชุนุฑุถ "ุฃ : [ุงุณู ุงููุนูู]"
5. โ ูุง ููุฌุฏ "ุบูุฑ ูุญุฏุฏ" ุฅูุง ููููุงุฏ ุจุฏูู ูุนูู ูุนูุงู
```

---

## ๐ **ุงููููุงุช ุงููุนุฏูุฉ:**

### **1. lib/ui/login_screen_new.dart:**
```dart
โ ุชุบููุฑ update() ุฅูู set() ูุน merge
โ ุฅุถุงูุฉ print statements ููุชุชุจุน
โ ุญูุธ FCM Token ูู users ู students/teachers/admins
```

### **2. lib/services/notification_service.dart:**
```dart
โ ุญุฐู _saveFCMToken() (ูุชุฌูุจ ุงูุชุนุงุฑุถ)
โ ุญุฐู imports ุบูุฑ ูุณุชุฎุฏูุฉ
โ ุงูุงุญุชูุงุธ ุจู _createNotificationChannel() ููุท
```

### **3. lib/ui/student/student_home_complete.dart:**
```dart
โ ุชุญุณูู _loadTeacherNames()
โ ุฌูุจ ูู subjects ุฃููุงู
โ ุซู ูู users ุฅุฐุง ูุฒู ุงูุฃูุฑ
โ ุฅุถุงูุฉ print statements ููุชุชุจุน
```

### **4. functions/index.js:**
```dart
โ ุชุบููุฑ ูู "homeworks" ุฅูู "homework"
โ ุฅุตูุงุญ syncTeacherSubjects
โ ููุดูุฑุฉ ููุญุฏุซุฉ
```

---

## ๐ฏ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:**

```
โ FCM Token ููุญูุธ ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู ูุจุงุดุฑุฉ
โ set() ูุน merge ูุถูู ุงูุญูุธ ุฏุงุฆูุงู
โ Token ููุฌูุฏ ูู users ู students/teachers/admins
โ Functions ุชุฌุฏ Token
โ ุงูุฅุดุนุงุฑุงุช ุชุตู ููุฑุงู
โ ุงูุตูุช ูุนูู (ูู Android channel)
โ ุงูุงูุชุฒุงุฒ ูุนูู (ูู Android channel)
โ ุงูุดุงุฑุฉ ุงูุญูุฑุงุก ุชุธูุฑ ููุฑุงู
โ ุฃุณูุงุก ุงููุนูููู ุชุธูุฑ ุฌููุนูุง
โ ูุฌูุจ ูู users ุฅุฐุง ูู ููู teacherName ููุฌูุฏ
```

---

## โ๏ธ **ููุงุญุธุงุช ูููุฉ ุฌุฏุงู:**

### **1. ุชุณุฌูู ุงูุฏุฎูู ุงูุฃูู:**
```
โ๏ธ ูุฌุจ ุชุณุฌูู ุฎุฑูุฌ ูุฏุฎูู ุจุนุฏ ุชุซุจูุช APK ุงูุฌุฏูุฏ
โ๏ธ ูุฐุง ูุญูุธ FCM Token ุงูุฌุฏูุฏ
โ๏ธ ุจุนุฏูุง ุงูุฅุดุนุงุฑุงุช ุณุชุนูู ุชููุงุฆูุงู
```

### **2. Console Logs:**
```
โ ุงูุชุญ Android Studio โ Logcat
โ ุงุจุญุซ ุนู:
   - "๐ FCM Token"
   - "โ FCM Token saved"
   - "ุชู ุชุญููู X ุงุณู ูุนูู"
   - "ุฌูุจ ุงุณู ุงููุนูู ูู users"
```

### **3. Firestore:**
```
โ ุชุญูู ูู:
   - users/{uid}/fcmToken
   - students/{uid}/fcmToken
   - subjects/{id}/teacherName ุฃู teacherId
```

### **4. Firebase Functions:**
```
โ ุชุญูู ูู Logs:
   firebase functions:log --only notifyStudentsOnHomework
โ ูุฌุจ ุฃู ุชุธูุฑ:
   "Homework notifications: X success, 0 failed"
```

---

## ๐ **ุงูุฎุทูุงุช ุงูููุงุฆูุฉ:**

```
1. ุงูุชุธุฑ ุงูุชูุงู ุจูุงุก APK
2. ุซุจูุช app-release.apk
3. ุณุฌู ุฎุฑูุฌ ูุฏุฎูู
4. ุงุฎุชุจุฑ ุงูุฅุดุนุงุฑุงุช
5. ุงุฎุชุจุฑ ุฃุณูุงุก ุงููุนูููู
6. โ ูู ุดูุก ูุฌุจ ุฃู ูุนูู ุงูุขู!
```

---

**ูุฐุง ูู ุงูุฅุตูุงุญ ุงูุดุงูู ุงูููุงุฆู! ๐**

**ุฌููุน ุงููุดุงูู ูุญูููุฉ ุจุดูู ููุงุฆู:**
- โ ุงูุฅุดุนุงุฑุงุช ูุน ุตูุช ูุงูุชุฒุงุฒ
- โ ุฃุณูุงุก ุงููุนูููู ุชุธูุฑ ุฌููุนูุง
- โ FCM Token ููุญูุธ ุจุดูู ููุซูู
- โ syncTeacherSubjects ูุญุณููุฉ
- โ ุฌููุน Functions ููุดูุฑุฉ ููุญุฏุซุฉ

**APK ุฌุงูุฒ ููุงุฎุชุจุงุฑ! ๐**
