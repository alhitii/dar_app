# ๐ง ุฅุตูุงุญ ูุฒุงููุฉ ุฃุณูุงุก ุงููุนูููู

## ๐ **ุงูุชุงุฑูุฎ:** 2 ููููุจุฑ 2025

---

## โ๏ธ **ุงููุดููุฉ:**

```
โ ุนูุฏ ุงุฎุชูุงุฑ ูุนูู ููุงุฏุฉุ ุงุณู ุงููุนูู ูุง ูุธูุฑ ูู ุงูุชุทุจูู
โ ุจุนุถ ุงูููุงุฏ ููุง ูุนูู ููู ุชุนุฑุถ "ุฃ : ุบูุฑ ูุญุฏุฏ"
```

---

## ๐ **ุงูุณุจุจ:**

### **ุงููุดููุฉ ูู syncTeacherSubjects Function:**

```javascript
// ุงูููุฏ ุงููุฏูู (ุงููุดููุฉ):
export const syncTeacherSubjects = onDocumentWritten("users/{userId}", async (event) => {
  const subjects = newData.subjects || [];
  const oldSubjects = previousData?.subjects || [];

  const batch = db.batch();

  // โ ุญุฐู ุฌููุน ุงูููุงุฏ ุงููุฏููุฉ ุฃููุงู
  for (const subjectId of oldSubjects) {
    batch.update(subjectRef, {
      teacherId: FieldValue.delete(),
      teacherName: FieldValue.delete()  // โ ูุญุฐู ุงูุงุณู!
    });
  }

  // ุซู ุฅุถุงูุฉ ุงูููุงุฏ ุงูุฌุฏูุฏุฉ
  for (const subjectId of subjects) {
    batch.update(subjectRef, {
      teacherId: event.params.userId,
      teacherName: newData.name
    });
  }

  await batch.commit();
});
```

### **ุงููุดููุฉ:**
```
1. ุงููุนูู ูุฏูู ููุงุฏ: [ูุงุฏุฉ1ุ ูุงุฏุฉ2ุ ูุงุฏุฉ3]
2. Admin ูุนุฏู ุงููุนูู (ุจุฏูู ุชุบููุฑ ุงูููุงุฏ)
3. Function ุชูุดุบูู:
   - ุชุญุฐู teacherName ูู ูุงุฏุฉ1ุ ูุงุฏุฉ2ุ ูุงุฏุฉ3
   - ุซู ุชุถูู teacherName ูููุณ ุงูููุงุฏ
4. โ ููู ุฅุฐุง ุญุฏุซ ุฎุทุฃ ุฃู ุชุฃุฎูุฑุ ุงูููุงุฏ ุชุจูู ุจุฏูู ุงุณู!
```

---

## โ **ุงูุญู:**

### **ุงูููุฏ ุงูุฌุฏูุฏ (ุงููุญุณูู):**

```javascript
export const syncTeacherSubjects = onDocumentWritten("users/{userId}", async (event) => {
  const newData = event.data?.after.data();
  const previousData = event.data?.before.data();

  if (!newData || newData.role !== "teacher") return;

  try {
    const subjects = newData.subjects || [];
    const oldSubjects = previousData?.subjects || [];

    const batch = db.batch();

    // โ ุญุฐู ุงูููุงุฏ ุงูุชู ุชู ุฅุฒุงูุชูุง ููุท
    const removedSubjects = oldSubjects.filter(id => !subjects.includes(id));
    for (const subjectId of removedSubjects) {
      const subjectRef = db.collection("subjects").doc(subjectId);
      batch.update(subjectRef, {
        teacherId: FieldValue.delete(),
        teacherName: FieldValue.delete()
      });
    }

    // โ ุชุญุฏูุซ ุฌููุน ุงูููุงุฏ ุงูุญุงููุฉ
    for (const subjectId of subjects) {
      const subjectRef = db.collection("subjects").doc(subjectId);
      batch.update(subjectRef, {
        teacherId: event.params.userId,
        teacherName: newData.name,
        lastUpdated: FieldValue.serverTimestamp()
      });
    }

    await batch.commit();
    console.log(`โ Teacher ${newData.name} subjects synced: ${subjects.length} subjects`);
    
  } catch (err) {
    console.error("โ Error syncing teacher subjects:", err);
  }
});
```

---

## ๐ **ููู ูุนูู ุงูุขู:**

### **ุงูุณููุงุฑูู 1: ุฅุถุงูุฉ ูุงุฏุฉ ุฌุฏูุฏุฉ ูููุนูู**
```
1. ุงููุนูู ูุฏูู: [ูุงุฏุฉ1ุ ูุงุฏุฉ2]
2. Admin ูุถูู ูุงุฏุฉ3
3. Function ุชูุดุบูู:
   โ removedSubjects = [] (ูุง ุดูุก ููุญุฐู)
   โ ุชุญุฏูุซ ูุงุฏุฉ1: teacherName = "ุงุณู ุงููุนูู"
   โ ุชุญุฏูุซ ูุงุฏุฉ2: teacherName = "ุงุณู ุงููุนูู"
   โ ุชุญุฏูุซ ูุงุฏุฉ3: teacherName = "ุงุณู ุงููุนูู"
4. โ ุฌููุน ุงูููุงุฏ ูุญุฏุซุฉ
```

### **ุงูุณููุงุฑูู 2: ุฅุฒุงูุฉ ูุงุฏุฉ ูู ุงููุนูู**
```
1. ุงููุนูู ูุฏูู: [ูุงุฏุฉ1ุ ูุงุฏุฉ2ุ ูุงุฏุฉ3]
2. Admin ูุญุฐู ูุงุฏุฉ3
3. Function ุชูุดุบูู:
   โ removedSubjects = [ูุงุฏุฉ3]
   โ ุญุฐู teacherName ูู ูุงุฏุฉ3
   โ ุชุญุฏูุซ ูุงุฏุฉ1: teacherName = "ุงุณู ุงููุนูู"
   โ ุชุญุฏูุซ ูุงุฏุฉ2: teacherName = "ุงุณู ุงููุนูู"
4. โ ูุงุฏุฉ3 ุจุฏูู ูุนููุ ูุงุฏุฉ1 ููุงุฏุฉ2 ูุญุฏุซุฉ
```

### **ุงูุณููุงุฑูู 3: ุชุนุฏูู ุงุณู ุงููุนูู**
```
1. ุงููุนูู ูุฏูู: [ูุงุฏุฉ1ุ ูุงุฏุฉ2]
2. Admin ูุบูุฑ ุงุณู ุงููุนูู ูู "ุฃุญูุฏ" ุฅูู "ูุญูุฏ"
3. Function ุชูุดุบูู:
   โ removedSubjects = [] (ูุง ุดูุก ููุญุฐู)
   โ ุชุญุฏูุซ ูุงุฏุฉ1: teacherName = "ูุญูุฏ"
   โ ุชุญุฏูุซ ูุงุฏุฉ2: teacherName = "ูุญูุฏ"
4. โ ุฌููุน ุงูููุงุฏ ูุญุฏุซุฉ ุจุงูุงุณู ุงูุฌุฏูุฏ
```

---

## ๐งช **ุงูุงุฎุชุจุงุฑ:**

### **1. ุชุซุจูุช APK ุงูุฌุฏูุฏ:**
```
๐ฑ build\app\outputs\flutter-apk\app-release.apk
```

### **2. ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ูุนูู ููุงุฏุฉ:**
```
1. ุณุฌู ุฏุฎูู ูู Admin
2. ุงุฐูุจ ุฅูู "ุงููุนูููู"
3. ุงุฎุชุฑ ูุนูู
4. ุงุถุบุท "ุชุนุฏูู"
5. ุฃุถู ูุงุฏุฉ ุฌุฏูุฏุฉ
6. ุงุญูุธ
7. โ Function ุณุชุญุฏุซ ุงููุงุฏุฉ ุชููุงุฆูุงู
8. ุณุฌู ุฏุฎูู ูุทุงูุจ
9. โ ุงุณู ุงููุนูู ูุธูุฑ ุชุญุช ุงููุงุฏุฉ
```

### **3. ุงุฎุชุจุงุฑ ุชุบููุฑ ุงุณู ุงููุนูู:**
```
1. ุณุฌู ุฏุฎูู ูู Admin
2. ุงุฐูุจ ุฅูู "ุงููุนูููู"
3. ุงุฎุชุฑ ูุนูู
4. ุงุถุบุท "ุชุนุฏูู"
5. ุบููุฑ ุงูุงุณู
6. ุงุญูุธ
7. โ Function ุณุชุญุฏุซ ุฌููุน ููุงุฏู
8. ุณุฌู ุฏุฎูู ูุทุงูุจ
9. โ ุงูุงุณู ุงูุฌุฏูุฏ ูุธูุฑ ูู ุฌููุน ุงูููุงุฏ
```

### **4. ุงุฎุชุจุงุฑ ุฅุฒุงูุฉ ูุงุฏุฉ ูู ูุนูู:**
```
1. ุณุฌู ุฏุฎูู ูู Admin
2. ุงุฐูุจ ุฅูู "ุงููุนูููู"
3. ุงุฎุชุฑ ูุนูู
4. ุงุถุบุท "ุชุนุฏูู"
5. ุงุญุฐู ูุงุฏุฉ
6. ุงุญูุธ
7. โ Function ุณุชุญุฐู teacherName ูู ุงููุงุฏุฉ
8. ุณุฌู ุฏุฎูู ูุทุงูุจ
9. โ ุงููุงุฏุฉ ุชุนุฑุถ "ุฃ : ุบูุฑ ูุญุฏุฏ"
```

---

## ๐ **ุงูููุงุฑูุฉ:**

### **ูุจู ุงูุฅุตูุงุญ:**
```
โ Function ุชุญุฐู ุฌููุน ุงูููุงุฏ ุงููุฏููุฉ ุฃููุงู
โ ุซู ุชุถูู ุงูููุงุฏ ุงูุฌุฏูุฏุฉ
โ ุฅุฐุง ุญุฏุซ ุฎุทุฃุ ุงูููุงุฏ ุชุจูู ุจุฏูู ุงุณู
โ ุชุนุงุฑุถ ูุญุชูู ูู Batch
```

### **ุจุนุฏ ุงูุฅุตูุงุญ:**
```
โ Function ุชุญุฐู ุงูููุงุฏ ุงูููุฒุงูุฉ ููุท
โ ุชุญุฏูุซ ุฌููุน ุงูููุงุฏ ุงูุญุงููุฉ ุฏูุนุฉ ูุงุญุฏุฉ
โ ูุง ููุฌุฏ ุชุนุงุฑุถ
โ ุฃูุซุฑ ููุงุกุฉ ูููุซูููุฉ
```

---

## ๐ง **ุฅุตูุงุญ ุงูููุงุฏ ุงูุญุงููุฉ:**

### **ุงูุทุฑููุฉ 1: ูู Admin Panel (ุงูุฃุณูู)**
```
1. ุณุฌู ุฏุฎูู ูู Admin
2. ุงุฐูุจ ุฅูู "ุงููุนูููู"
3. ููู ูุนูู:
   - ุงุถุบุท "ุชุนุฏูู"
   - ุงุญูุธ (ุจุฏูู ุชุบููุฑ)
4. โ Function ุณุชุญุฏุซ ุฌููุน ููุงุฏู ุชููุงุฆูุงู
```

### **ุงูุทุฑููุฉ 2: ูู Firebase Console**
```
1. ุงูุชุญ Firebase Console
2. Firestore โ users
3. ุงุฎุชุฑ ุฃู ูุนูู
4. ุนุฏูู ุฃู field (ูุซู ุฃุถู ูุณุงูุฉ ูู name)
5. ุงุญูุธ
6. โ Function ุชุนูู ุชููุงุฆูุงู
```

### **ุงูุทุฑููุฉ 3: ุงุณุชุฎุฏุงู updateAllTeacherNames Function**
```
1. ุณุฌู ุฏุฎูู ูู ุงูุชุทุจูู
2. ุงุณุชุฏุนู Function ูู ุงูููุฏ:
   
   final result = await FirebaseFunctions.instance
       .httpsCallable('updateAllTeacherNames')
       .call();
   
3. โ ุณุชุญุฏุซ ุฌููุน ุงูููุงุฏ ูุฌููุน ุงููุนูููู
```

---

## ๐ **ุงููููุงุช ุงููุนุฏูุฉ:**

```
โ functions/index.js
   - ุฅุตูุงุญ syncTeacherSubjects
   - ุฅุถุงูุฉ updateAllTeacherNames (callable function)
   - ููุดูุฑุฉ ููุญุฏุซุฉ

โ lib/ui/login_screen_new.dart
   - ุญูุธ FCM Token ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู
   - ุญูุธ ูู users ู students/teachers/admins

โ lib/ui/student/student_home_complete.dart
   - listener ูููุงุฌุจุงุช (ุชุญุฏูุซ ููุฑู)
   - ุชุจุณูุท ุชุญููู ุฃุณูุงุก ุงููุนูููู ูู subjects
```

---

## ๐ฏ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:**

```
โ syncTeacherSubjects ูุญุณููุฉ
โ ูุง ุชุญุฐู ุงูููุงุฏ ุฅูุง ุฅุฐุง ุชู ุฅุฒุงูุชูุง ูุนููุงู
โ ุชุญุฏูุซ ููุฑู ูููุซูู
โ ุงุณู ุงููุนูู ูุธูุฑ ูู ุฌููุน ุงูููุงุฏ
โ FCM Token ููุญูุธ ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู
โ ุงูุฅุดุนุงุฑุงุช ุชุตู ูุน ุตูุช ูุงูุชุฒุงุฒ
```

---

## โ๏ธ **ููุงุญุธุงุช ูููุฉ:**

### **1. ุชุญุฏูุซ ุงูููุงุฏ ุงูุญุงููุฉ:**
```
โ๏ธ ุงูููุงุฏ ุงูุชู ููุง ูุนูู ููู ุจุฏูู teacherName
โ๏ธ ูุฌุจ ุชุญุฏูุซูุง ูุฏููุงู (ุชุนุฏูู ุงููุนูู ูุญูุธ)
โ๏ธ ุฃู ุงุณุชุฎุฏุงู updateAllTeacherNames Function
```

### **2. Function Triggers:**
```
โ ุชุนูู ุชููุงุฆูุงู ุนูุฏ:
   - ุฅุถุงูุฉ ูุงุฏุฉ ูููุนูู
   - ุฅุฒุงูุฉ ูุงุฏุฉ ูู ุงููุนูู
   - ุชุบููุฑ ุงุณู ุงููุนูู
   - ุฃู ุชุนุฏูู ุนูู document ุงููุนูู
```

### **3. ุงูุฅุดุนุงุฑุงุช:**
```
โ FCM Token ููุญูุธ ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
โ ุงูุฅุดุนุงุฑุงุช ุชุตู ููุฑุงู
โ ุงูุตูุช ูุงูุงูุชุฒุงุฒ ูุนููุงู
โ๏ธ ูุฌุจ ุชุณุฌูู ุฎุฑูุฌ ูุฏุฎูู ุจุนุฏ ุชุซุจูุช APK ุงูุฌุฏูุฏ
```

---

**ุฌููุน ุงููุดุงูู ูุญูููุฉ! ๐**

**APK ุงูุฌุฏูุฏ:**
```
build\app\outputs\flutter-apk\app-release.apk
```

**ุงูุฎุทูุงุช ุงูุชุงููุฉ:**
1. ุซุจูุช APK ุงูุฌุฏูุฏ
2. ุณุฌู ุฎุฑูุฌ ูุฏุฎูู
3. ูู Admin Panel: ุนุฏูู ูู ูุนูู ูุงุญูุธ
4. โ ุฌููุน ุงูููุงุฏ ุณุชูุญุฏูุซ ุชููุงุฆูุงู
