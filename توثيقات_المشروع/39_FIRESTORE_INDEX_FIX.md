# ๐ง ุฅุตูุงุญ ุฎุทุฃ Firestore Index

## ๐ **ุงูุชุงุฑูุฎ:** 1 ููููุจุฑ 2025

---

## โ **ุงูุฎุทุฃ:**

```
The query requires an index. You can create it here:
https://console.firebase.google.com/v1/r/project/...
```

---

## ๐ฏ **ุงูุณุจุจ:**

### **ุงูุงุณุชุนูุงูุงุช ุงูุชู ุชุญุชุงุฌ ููุฑุณ:**

```dart
// ูู student_absence_management_screen.dart
FirebaseFirestore.instance
    .collection('absences')
    .where('studentUid', isEqualTo: widget.studentUid)
    .orderBy('timestamp', descending: true)  // โ ูุญุชุงุฌ ููุฑุณ
    .limit(50)
    .snapshots()

// ูู absence_history_screen.dart
FirebaseFirestore.instance
    .collection('absences')
    .where('studentUid', isEqualTo: studentUid)
    .orderBy('absenceDate', descending: true)  // โ ูุญุชุงุฌ ููุฑุณ
    .snapshots()
```

### **ููุงุฐุง ูุญุชุงุฌ ููุฑุณุ**
```
โ ุนูุฏ ุงุณุชุฎุฏุงู where() ูุน orderBy() ุนูู ุญููู ูุฎุชููุฉ
โ Firestore ูุญุชุงุฌ ููุฑุณ ูุฑูุจ (Composite Index)
โ ุงูููุฑุณ ูุญุณู ุงูุฃุฏุงุก ููุณูุญ ุจุงูุงุณุชุนูุงู
```

---

## โ **ุงูุญููู:**

### **ุงูุญู 1: ุงุณุชุฎุฏุงู ุงูุฑุงุจุท (ุงูุฃุณุฑุน)**

```
1. ุงูุณุฎ ุงูุฑุงุจุท ูู ุฑุณุงูุฉ ุงูุฎุทุฃ
2. ุงูุชุญู ูู ุงููุชุตูุญ
3. ุงุถุบุท "Create Index" ุฃู "ุฅูุดุงุก ุงูููุฑุณ"
4. ุงูุชุธุฑ 2-5 ุฏูุงุฆู
5. ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู
```

### **ุงูุญู 2: ูู Firebase Console ูุฏููุงู**

```
1. ุงูุชุญ Firebase Console
2. ุงุฐูุจ ุฅูู Firestore Database
3. ุงุถุบุท ุนูู ุชุจููุจ "Indexes"
4. ุงุถุบุท "Create Index"
5. ุงุฎุชุฑ:
   - Collection: absences
   - Fields:
     * studentUid (Ascending)
     * timestamp (Descending)
6. ุงุถุบุท "Create"
7. ูุฑุฑ ููููุฑุณ ุงูุซุงูู:
   - Collection: absences
   - Fields:
     * studentUid (Ascending)
     * absenceDate (Descending)
```

### **ุงูุญู 3: ุงุณุชุฎุฏุงู firestore.indexes.json**

```json
{
  "indexes": [
    {
      "collectionGroup": "absences",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "studentUid",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "timestamp",
          "order": "DESCENDING"
        }
      ]
    },
    {
      "collectionGroup": "absences",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "studentUid",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "absenceDate",
          "order": "DESCENDING"
        }
      ]
    }
  ]
}
```

**ุซู ูุดุฑู:**
```bash
firebase deploy --only firestore:indexes
```

---

## ๐ **ุงูููุงุฑุณ ุงููุทููุจุฉ:**

### **ููุฑุณ 1: ููุบูุงุจุงุช ุจู timestamp**
```
Collection: absences
Fields:
  - studentUid (Ascending)
  - timestamp (Descending)
```

### **ููุฑุณ 2: ููุบูุงุจุงุช ุจู absenceDate**
```
Collection: absences
Fields:
  - studentUid (Ascending)
  - absenceDate (Descending)
```

---

## ๐ฏ **ุงูุฎุทูุงุช ุงูููุตู ุจูุง:**

### **ุงูุขู (ุนุงุฌู):**
```
1. โ ุงููุฑ ุนูู ุงูุฑุงุจุท ูู ุฑุณุงูุฉ ุงูุฎุทุฃ
2. โ ุงุถุบุท "Create Index"
3. โ ุงูุชุธุฑ ุญุชู ููุชูู ุงูุจูุงุก
4. โ ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู
```

### **ุจุนุฏ ุฐูู:**
```
1. โ ุชุญูู ูู ุนูู ุตูุญุฉ ุงูุบูุงุจ
2. โ ุงุฎุชุจุฑ ุชุญููู ุณุฌู ุงูุบูุงุจ
3. โ ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก
```

---

## ๐ **ููุงุญุธุงุช:**

### **1. ููุช ุงูุจูุงุก:**
```
โ ุงูููุงุฑุณ ุงูุตุบูุฑุฉ: 1-2 ุฏูููุฉ
โ ุงูููุงุฑุณ ุงููุจูุฑุฉ: 5-10 ุฏูุงุฆู
โ ูุนุชูุฏ ุนูู ุญุฌู ุงูุจูุงูุงุช
```

### **2. ุงูุชูููุฉ:**
```
โ ุงูููุงุฑุณ ูุฌุงููุฉ ูู Firestore
โ ูุง ุชุคุซุฑ ุนูู ุงููุงุชูุฑุฉ
โ ุชุญุณู ุงูุฃุฏุงุก ููุท
```

### **3. ุงูุตูุงูุฉ:**
```
โ ุงูููุงุฑุณ ุชูุญุฏูุซ ุชููุงุฆูุงู
โ ูุง ุชุญุชุงุฌ ุตูุงูุฉ ูุฏููุฉ
โ ุชุนูู ูู ุงูุฎูููุฉ
```

---

## ๐ **ุงูุชุญูู ูู ุงูููุงุฑุณ:**

### **ูู Firebase Console:**
```
1. ุงูุชุญ Firestore Database
2. ุงุถุบุท ุนูู "Indexes"
3. ุณุชุฌุฏ ูุงุฆูุฉ ุจุฌููุน ุงูููุงุฑุณ
4. ุชุญูู ูู ุงูุญุงูุฉ:
   - Building (ููุฏ ุงูุจูุงุก) โณ
   - Enabled (ููุนูู) โ
   - Error (ุฎุทุฃ) โ
```

---

## ๐ **ุจุนุฏ ุงูุฅุตูุงุญ:**

```
โ ุตูุญุฉ ุงูุบูุงุจ ุชุนูู ุจุดูู ุตุญูุญ
โ ุณุฌู ุงูุบูุงุจ ููุญููู ุจุณุฑุนุฉ
โ ูุง ุชูุฌุฏ ุฑุณุงุฆู ุฎุทุฃ
โ ุงูุฃุฏุงุก ูุญุณูู
```

---

## ๐ **ุงููููุงุช ุงููุถุงูุฉ:**

```
โ firestore.indexes.json
   - ุชุนุฑูู ุงูููุงุฑุณ ุงููุทููุจุฉ
   - ุฌุงูุฒ ูููุดุฑ

โ ุชูุซููุงุช_ุงููุดุฑูุน/39_FIRESTORE_INDEX_FIX.md
   - ุชูุซูู ุดุงูู
   - ุฎุทูุงุช ุงูุญู
```

---

## ๐ก **ูุตูุญุฉ:**

```
ุฏุงุฆูุงู ุนูุฏ ุงุณุชุฎุฏุงู:
.where('field1', ...)
.orderBy('field2', ...)

ุชุญุชุงุฌ ููุฑุณ ูุฑูุจ!

Firestore ุณูุฎุจุฑู ุจุงูุฑุงุจุท ูุฅูุดุงุฆู ุชููุงุฆูุงู
```

---

**ุงูุญุงูุฉ:** โ๏ธ ูุญุชุงุฌ ุฅุตูุงุญ  
**ุงูุฃููููุฉ:** ุนุงููุฉ ๐ด  
**ุงูุญู:** ุณูู ูุณุฑูุน โ  
**ุงูููุช:** 2-5 ุฏูุงุฆู โฑ๏ธ
