# ๐จ ุฅุตูุงุญ ุฅุดุนุงุฑุงุช ุงูุบูุงุจ

## ๐ **ุงูุชุงุฑูุฎ:** 1 ููููุจุฑ 2025

---

## โ **ุงููุดููุฉ:**

```
ุฅุดุนุงุฑ ุงูุบูุงุจ ูุง ูุตู ุฅูู ุญุณุงุจ ุงูุทุงูุจ ุงูููุตูุฏ
```

**ุงูุณุจุจ:**
- ุงูุฅุดุนุงุฑ ููุญูุธ ูู Firestore ุจุดูู ุตุญูุญ โ
- ููู ูุง ููุฌุฏ ููุฏ ูุนุฑุถู ูู ุญุณุงุจ ุงูุทุงูุจ โ

---

## โ **ุงูุญู:**

### **1๏ธโฃ ุฅุถุงูุฉ ุชุญููู ุฅุดุนุงุฑุงุช ุงูุบูุงุจ:**

```dart
// ูู _StudentHomeCompleteState
List<Map<String, dynamic>> _absenceNotifications = [];

Future<void> _loadAbsenceNotifications() async {
  final user = FirebaseAuth.instance.currentUser;
  if (user == null) return;

  final now = DateTime.now();
  
  final absencesSnapshot = await FirebaseFirestore.instance
      .collection('notifications_absences')
      .where('studentUid', isEqualTo: user.uid)
      .where('expiresAt', isGreaterThan: Timestamp.fromDate(now))
      .orderBy('expiresAt', descending: true)
      .orderBy('createdAt', descending: true)
      .get();

  final List<Map<String, dynamic>> notifications = [];
  
  for (var doc in absencesSnapshot.docs) {
    notifications.add({
      'id': doc.id,
      ...doc.data(),
    });
  }
  
  setState(() {
    _absenceNotifications = notifications;
  });
}
```

---

### **2๏ธโฃ ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ:**

```dart
// ูู build method
children: [
  _buildProfileCard(),
  
  const SizedBox(height: 24),
  
  // ุฅุดุนุงุฑุงุช ุงูุบูุงุจ
  if (_absenceNotifications.isNotEmpty) ...[
    _buildAbsenceNotifications(),
    const SizedBox(height: 24),
  ],
  
  // ุงูููุงุฏ...
]
```

---

### **3๏ธโฃ ุชุตููู ุจุทุงูุฉ ุงูุฅุดุนุงุฑ:**

```dart
Widget _buildAbsenceNotifications() {
  return Column(
    children: _absenceNotifications.map((absence) {
      final message = absence['message'];
      final date = absence['date'];
      
      return Container(
        decoration: BoxDecoration(
          gradient: LinearGradient(
            colors: [Color(0xFFFFEBEE), Color(0xFFFFCDD2)],
          ),
          borderRadius: BorderRadius.circular(16),
          border: Border.all(color: Colors.red[300], width: 2),
        ),
        child: Column(
          children: [
            // ุฃููููุฉ ุชุญุฐูุฑ + ุนููุงู + ุชุงุฑูุฎ
            Row(
              children: [
                Icon(Icons.warning, color: Colors.red),
                Text('ุฅุดุนุงุฑ ุบูุงุจ'),
                Text(dateStr),
              ],
            ),
            // ุฑุณุงูุฉ ุงูุบูุงุจ
            Text(message),
          ],
        ),
      );
    }).toList(),
  );
}
```

---

## ๐ **ููู ูุนูู:**

### **ุนูุฏ ุฅุฑุณุงู ุฅุดุนุงุฑ ุบูุงุจ:**

```
1. Admin ููุชุญ ุตูุญุฉ ุงูุทุงูุจ
2. ูุถุบุท "ุฅุฑุณุงู ุฅุดุนุงุฑ ุบูุงุจ"
3. ููุชุจ ุงูุฑุณุงูุฉ ููุฎุชุงุฑ ุงูุชุงุฑูุฎ
4. ููุญูุธ ูู notifications_absences:
   - studentUid: UID ุงูุทุงูุจ
   - message: ุฑุณุงูุฉ ุงูุบูุงุจ
   - date: ุชุงุฑูุฎ ุงูุบูุงุจ
   - expiresAt: ููุชูู ุจุนุฏ 24 ุณุงุนุฉ
   - createdAt: ููุช ุงูุฅูุดุงุก
```

---

### **ูู ุญุณุงุจ ุงูุทุงูุจ:**

```
1. ุนูุฏ ูุชุญ ุงูุชุทุจูู
2. ูุชู ุชุญููู ุงูุฅุดุนุงุฑุงุช ูู Firestore
3. ููุท ุงูุฅุดุนุงุฑุงุช ุงูุชู ูู ุชูุชูู (expiresAt > now)
4. ุชุธูุฑ ูู ุฃุนูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
5. ุจุชุตููู ุฃุญูุฑ ูุงุถุญ ูุน ุฃููููุฉ ุชุญุฐูุฑ
```

---

## ๐จ **ุงูุชุตููู:**

### **ุจุทุงูุฉ ุงูุฅุดุนุงุฑ:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ  ุฅุดุนุงุฑ ุบูุงุจ        15/11/2025  โ
โ                                     โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ุบุงุจ ุงูุทุงูุจ ููู ุงูุฃุญุฏ ุจุฏูู      โ โ
โ โ ุนุฐุฑ. ูุฑุฌู ุงููุชุงุจุนุฉ ูุน ููู      โ โ
โ โ ุงูุฃูุฑ.                           โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ุงูุฃููุงู:**
- ุฎูููุฉ: ุชุฏุฑุฌ ุฃุญูุฑ ูุงุชุญ
- ุญุฏูุฏ: ุฃุญูุฑ ูุชูุณุท
- ุฃููููุฉ: ุฃุญูุฑ ุฏุงูู
- ุงููุต: ุฃุณูุฏ

---

## ๐ **ุงูุงุณุชุนูุงู ูู Firestore:**

```dart
.collection('notifications_absences')
.where('studentUid', isEqualTo: user.uid)  // ููุทุงูุจ ุงููุญุฏุฏ
.where('expiresAt', isGreaterThan: now)    // ูู ููุชูู ุจุนุฏ
.orderBy('expiresAt', descending: true)    // ุงูุฃุญุฏุซ ุฃููุงู
.orderBy('createdAt', descending: true)
```

---

## โฐ **ูุฏุฉ ุงูุนุฑุถ:**

```
- ูุธูุฑ ุงูุฅุดุนุงุฑ ููุฏุฉ 24 ุณุงุนุฉ
- ุจุนุฏ 24 ุณุงุนุฉ ูุฎุชูู ุชููุงุฆูุงู
- ูุจูู ูู ุณุฌู ุงูุบูุงุจุงุช ููุฏุฉ ุณูุฉ
```

---

## ๐ **ุงููููุงุช ุงููุนุฏูุฉ:**

```
โ lib/ui/student/student_home_complete.dart
   - ุฅุถุงูุฉ _absenceNotifications
   - ุฅุถุงูุฉ _loadAbsenceNotifications()
   - ุฅุถุงูุฉ _buildAbsenceNotifications()
   - ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
```

---

## ๐งช **ููุงุฎุชุจุงุฑ:**

### **ูู Admin:**
```
1. ุงูุชุญ ุตูุญุฉ ุทุงูุจ
2. ุงุถุบุท "ุฅุฑุณุงู ุฅุดุนุงุฑ ุบูุงุจ"
3. ุงูุชุจ ุฑุณุงูุฉ ูุงุฎุชุฑ ุชุงุฑูุฎ
4. ุงุถุบุท "ุฅุฑุณุงู"
```

### **ูู ุทุงูุจ:**
```
1. ุณุฌู ุฏุฎูู ุจุญุณุงุจ ุงูุทุงูุจ
2. ูุฌุจ ุฃู ุชุฑู ุงูุฅุดุนุงุฑ ูู ุฃุนูู ุงูุตูุญุฉ
3. ุจุชุตููู ุฃุญูุฑ ูุงุถุญ
4. ูุญุชูู ุนูู ุงูุฑุณุงูุฉ ูุงูุชุงุฑูุฎ
```

---

## ๐ฏ **ุงููุชูุฌุฉ:**

```
โ ุงูุฅุดุนุงุฑ ููุฑุณู ุจูุฌุงุญ
โ ูุธูุฑ ูู ุญุณุงุจ ุงูุทุงูุจ ุงูููุตูุฏ
โ ุชุตููู ูุงุถุญ ููููุช
โ ููุชูู ุชููุงุฆูุงู ุจุนุฏ 24 ุณุงุนุฉ
```

---

**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ  
**ูุญุชุงุฌ:** ุงุฎุชุจุงุฑ
