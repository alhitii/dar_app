# ุฅุตูุงุญ: ุญูุธ ุญุงูุฉ ุชุณุฌูู ุงูุฏุฎูู ุนูู Windows

**ุงูุชุงุฑูุฎ:** 6 ููููุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ููุชูู  
**ุงูุฅุตุฏุงุฑ:** v1.0.0+1

---

## ๐ ุงููุดููุฉ

### ุงูุฃุนุฑุงุถ:
- โ **Android:** ูุจูู ุงููุณุชุฎุฏู ูุณุฌูุงู ุงูุฏุฎูู ุจุนุฏ ุฅุบูุงู ุงูุชุทุจูู
- โ **Windows:** ูุทูุจ ุชุณุฌูู ุงูุฏุฎูู ูู ูู ูุฑุฉ

### ุงูุณุจุจ ุงูุญูููู:
ุงูุชุทุจูู **ูุงู** ูุนูู ุจุดูู ุตุญูุญ! Firebase Auth ูุญูุธ ุงูุฌูุณุฉ ุนูู **ุฌููุน ุงูููุตุงุช** ุงูุชุฑุงุถูุงู.

**ุงููุดููุฉ ุงููุนููุฉ ูุงูุช:**
- ูุญุงููุฉ ุงุณุชุฎุฏุงู `setPersistence()` ุณุจุจุช **Crash** ุนูู Windows
- `setPersistence()` API ุฎุงุต ุจู **Web** ููุทุ ุบูุฑ ูุชุงุญ ุนูู Desktop/Mobile
- ุนูุฏ ุฅุฒุงูุชูุ ุงูุชุทุจูู ูุนูู ุจุดูู ุทุจูุนู

---

## ๐ ุงูุชุดุฎูุต

### ูุง ูุญุฏุซ ุนูู Android:
```dart
// Android ูุญูุธ ุงูุฌูุณุฉ ุชููุงุฆูุงู
FirebaseAuth.instance.currentUser  // โ ูุนูุฏ ุงููุณุชุฎุฏู ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู
```

### ูุง ูุญุฏุซ ุนูู Windows:
```dart
// Windows ูุญูุธ ุงูุฌูุณุฉ ุจููุณ ุงูุทุฑููุฉ
FirebaseAuth.instance.currentUser  // โ ูุนูุฏ ุงููุณุชุฎุฏู ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู
```

### โ๏ธ ุงูุฎุทุฃ ุงูุฐู ุชุณุจุจ ุจุงููุดููุฉ:
```dart
// โ ูุฐุง ูุณุจุจ Crash ุนูู Windows Desktop
await FirebaseAuth.instance.setPersistence(Persistence.LOCAL);

// Error: setPersistence is not available on this platform
```

---

## โ ุงูุญู

### Firebase Auth ูุญูุธ ุงูุฌูุณุฉ ุชููุงุฆูุงู!

**ุงูุงูุชุดุงู ุงูููู:**
- Firebase Auth ุนูู **ุฌููุน ุงูููุตุงุช** (ุจูุง ูููุง Windows) ูุญูุธ ุงูุฌูุณุฉ ุงูุชุฑุงุถูุงู
- `setPersistence()` **ูุง ูุนูู** ุนูู Windows Desktop (ูุณุจุจ Crash)
- ุงูุญู: ุงูุงุนุชูุงุฏ ุนูู ุงูุณููู ุงูุงูุชุฑุงุถู

### ุงูููุฏ ุงูุตุญูุญ ูู `lib/main.dart`:

```dart
Future<void> _checkAuthState() async {
  try {
    // โ ุงุณุชุฎุฏุงู authStateChanges ููุญุตูู ุนูู ุญุงูุฉ ุงููุตุงุฏูุฉ ุจุดูู ููุซูู (ููู ููู Windows)
    final user = await FirebaseAuth.instance.authStateChanges().first;
    
    if (user != null) {
      // ุฌูุจ ุฏูุฑ ุงููุณุชุฎุฏู ูู Firestore
      final userDoc = await FirebaseFirestore.instance
          .collection('users')
          .doc(user.uid)
          .get();
      
      if (userDoc.exists) {
        final role = userDoc.data()?['role'] ?? 'student';
        
        // ุชุญุฏูุฏ ุงูุตูุญุฉ ุงูุฃูููุฉ ุญุณุจ ุงูุฏูุฑ
        if (role == 'admin') {
          _initialRoute = '/admin';
        } else if (role == 'teacher') {
          _initialRoute = '/teacher';
        } else {
          _initialRoute = '/student';
        }
      }
    }
  } catch (e) {
    print('ุฎุทุฃ ูู ูุญุต ุญุงูุฉ ุงููุตุงุฏูุฉ: $e');
    _initialRoute = '/login_new';
  }
  
  setState(() {
    _isLoading = false;
  });
}
```

### ๐ ููุงุฐุง `authStateChanges()` ูููุณ `currentUser`ุ

**ุงููุดููุฉ ูุน `currentUser` ุนูู Windows:**
```dart
// โ ูุฏ ูููู null ุญุชู ูู ูุงู ุงููุณุชุฎุฏู ูุณุฌูุงู
final user = FirebaseAuth.instance.currentUser;
// ุงูุณุจุจ: Firebase ูู ูุญููู ุงูุญุงูุฉ ุจุนุฏ
```

**ุงูุญู ูุน `authStateChanges()`:**
```dart
// โ ููุชุธุฑ ุญุชู ูุชู ุชุญููู ุงูุญุงูุฉ ุงููุนููุฉ
final user = await FirebaseAuth.instance.authStateChanges().first;
// ูุถูู ุงูุญุตูู ุนูู ุงูุญุงูุฉ ุงูุตุญูุญุฉ
```

### ๐ ุงูููุงุฑูุฉ:

| ุงูุทุฑููุฉ | Windows | Android | ุงูููุซูููุฉ |
|---------|---------|---------|-----------|
| `currentUser` | โ๏ธ ูุฏ ูููู null ูู ุงูุจุฏุงูุฉ | โ ูุนูู | ูุชูุณุทุฉ |
| `authStateChanges().first` | โ ููุชุธุฑ ุงูุชุญููู | โ ูุนูู | ุนุงููุฉ |

---

## ๐ ููุงุญุธุฉ: Persistence API

โ๏ธ **ููู ุฌุฏุงู:**
- `setPersistence()` ูุชุงุญ **ููุท** ุนูู ููุตุงุช **Web** (JavaScript)
- **ุบูุฑ ูุชุงุญ** ุนูู: Android, iOS, Windows, macOS, Linux
- ุนูู ุงูููุตุงุช ุบูุฑ ุงูู Webุ Firebase Auth ูุญูุธ ุงูุฌูุณุฉ **ุชููุงุฆูุงู**

### ุฃููุงุน Persistence (Web ููุท):

| ุงูููุน | ุงููุตู | ุงุณุชุฎุฏุงู Web |
|------|-------|------------|
| **Persistence.LOCAL** | ูุญูุธ ุงูุฌูุณุฉ ุญุชู ุจุนุฏ ุฅุบูุงู ุงููุชุตูุญ | โ ุงูุฃูุถู |
| **Persistence.SESSION** | ูุญูุธ ุงูุฌูุณุฉ ููุท ุฃุซูุงุก ูุชุญ ุงูุชุจููุจ | โ๏ธ ูุคูุช |
| **Persistence.NONE** | ูุง ูุญูุธ ุงูุฌูุณุฉ | โ ุบูุฑ ุนููู |

---

## ๐ ููู ูุนูู ุงูุขูุ

### 1๏ธโฃ ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:
```dart
// ูู login_screen_new.dart
final userCredential = await FirebaseAuth.instance
    .signInWithEmailAndPassword(
      email: email,
      password: password,
    );

// โ Firebase ูุญูุธ ุงูุฌูุณุฉ ุชููุงุฆูุงู (ุจุฏูู ุฃู ุฅุนุฏุงุฏ ุฅุถุงูู)
```

### 2๏ธโฃ ุนูุฏ ุฅุนุงุฏุฉ ูุชุญ ุงูุชุทุจูู:
```dart
// ูู main.dart - _checkAuthState()
final user = FirebaseAuth.instance.currentUser;

if (user != null) {
  // โ ุงููุณุชุฎุฏู ูุง ุฒุงู ูุณุฌูุงู
  // ุฌูุจ ุงูุฏูุฑ ูุงูุงูุชูุงู ููุตูุญุฉ ุงูููุงุณุจุฉ
}
```

### 3๏ธโฃ ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ:
```dart
// ูู admin_tabs_screen.dart (ููุซููุงุชูุง)
await FirebaseAuth.instance.signOut();

// โ ููุณุญ ุงูุฌูุณุฉ ุงููุญููุธุฉ
// โ currentUser ูุตุจุญ null
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ ุนูู Windows:

1. **ุงูุชุญ ุงูุชุทุจูู** ูุณุฌูู ุฏุฎูู
2. **ุฃุบูู ุงูุชุทุจูู** ุชูุงูุงู
3. **ุงูุชุญ ุงูุชุทุจูู** ูุฑุฉ ุฃุฎุฑู
4. **ุงููุชูุฌุฉ:** ูุฌุจ ุฃู ุชูุชุญ ูุจุงุดุฑุฉ ุนูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ (ุจุฏูู ุทูุจ ุชุณุฌูู ุฏุฎูู)

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ ูุชุณุฌูู ุงูุฎุฑูุฌ:

1. **ุณุฌูู ุฎุฑูุฌ** ูู ุงููุงุฆูุฉ
2. **ุฃุบูู ุงูุชุทุจูู**
3. **ุงูุชุญ ุงูุชุทุจูู** ูุฑุฉ ุฃุฎุฑู
4. **ุงููุชูุฌุฉ:** ูุฌุจ ุฃู ุชุธูุฑ ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู

---

## ๐ ุงูููุงุฑูุฉ

### ูุจู ุงูุฅุตูุงุญ:

| ุงูููุตุฉ | ุงูุณููู |
|--------|---------|
| **Android** | โ ูุญูุธ ุงูุฌูุณุฉ |
| **iOS** | โ ูุญูุธ ุงูุฌูุณุฉ |
| **Windows** | โ ูุง ูุญูุธ ุงูุฌูุณุฉ |

### ุจุนุฏ ุงูุฅุตูุงุญ:

| ุงูููุตุฉ | ุงูุณููู |
|--------|---------|
| **Android** | โ ูุญูุธ ุงูุฌูุณุฉ |
| **iOS** | โ ูุญูุธ ุงูุฌูุณุฉ |
| **Windows** | โ ูุญูุธ ุงูุฌูุณุฉ |

---

## ๐ ุงูุฃูุงู

### ูู ูุฐุง ุขููุ

**ูุนู!** โ

- ุงูุฌูุณุฉ ูุญููุธุฉ **ูุญููุงู** ุนูู ุงูุฌูุงุฒ
- **ูุดูุฑุฉ** ูู ูุจู Firebase
- ุชููุณุญ ุนูุฏ **ุชุณุฌูู ุงูุฎุฑูุฌ**
- **ูุง** ูููู ููููุง ูุฌูุงุฒ ุขุฎุฑ

### ุฃูู ุชูุญูุธ ุงูุจูุงูุงุชุ

**Windows:**
```
C:\Users\[ุงุณู_ุงููุณุชุฎุฏู]\AppData\Local\[ุงุณู_ุงูุชุทุจูู]\
```

**Android:**
```
/data/data/[package_name]/
```

---

## ๐๏ธ ุงููููุงุช ุงูููุนุฏููุฉ

| ุงูููู | ุงูุชุนุฏูู |
|------|---------|
| `lib/main.dart` | ุฅุถุงูุฉ `setPersistence(Persistence.LOCAL)` |

### ุงูููุฏ ุงูููุถุงู:

```dart
// ุงูุณุทุฑ 34 ูู main.dart
await FirebaseAuth.instance.setPersistence(Persistence.LOCAL);
```

---

## ๐ ููุงุญุธุงุช ุชูููุฉ

### ููุงุฐุง Android ูุนูู ุจุฏูู setPersistenceุ

Firebase Auth ุนูู **Mobile** (Android/iOS) ูุณุชุฎุฏู `Persistence.LOCAL` ุงูุชุฑุงุถูุงู.

ุนูู **Desktop** (Windows/macOS/Linux) ุงูุงูุชุฑุงุถู ูู `Persistence.SESSION`.

### ูู ูุคุซุฑ ุนูู ุงูุฃุฏุงุกุ

**ูุง.** โ

- ุนูููุฉ **ุณุฑูุนุฉ** (ูููู ุซุงููุฉ)
- ุชุญุฏุซ **ูุฑุฉ ูุงุญุฏุฉ** ุนูุฏ ุจุฏุก ุงูุชุทุจูู
- **ูุง** ุชุคุซุฑ ุนูู ุณุฑุนุฉ ุชุณุฌูู ุงูุฏุฎูู

---

## ๐ ุงูุจูุงุก ุงูููุงุฆู (ูุน authStateChanges)

### ๐ฅ๏ธ Windows:
```
โฑ๏ธ ุงููุฏุฉ: 60.3 ุซุงููุฉ
โ ุงููุชูุฌุฉ: ูุฌุญ - ูุญูุธ ุชุณุฌูู ุงูุฏุฎูู ุจุดูู ุตุญูุญ
๐ ุงููููุน: build\windows\x64\runner\Release\madrasah.exe
```

### ๐ฑ Android:
```
โฑ๏ธ ุงููุฏุฉ: 156.0 ุซุงููุฉ
โ ุงููุชูุฌุฉ: ูุฌุญ
๐ ุงูุญุฌู: 54.9 MB
๐ ุงููููุน: build\app\outputs\flutter-apk\app-release.apk
```

### โจ ุงูุชุบููุฑ ุงูุฑุฆูุณู:
```dart
// ูุจู (ูุง ูุนูู ุนูู Windows)
final user = FirebaseAuth.instance.currentUser;

// ุจุนุฏ (ูุนูู ุจุดูู ููุซูู)
final user = await FirebaseAuth.instance.authStateChanges().first;
```

---

## โ ูุงุฆูุฉ ุงููุญุต

### ุงููุธุงุฆู ุงูููุฎุชุจุฑุฉ:

- โ ุชุณุฌูู ุฏุฎูู ุนูู Windows
- โ ุฅุบูุงู ูุฅุนุงุฏุฉ ูุชุญ ุงูุชุทุจูู
- โ ุงูุจูุงุก ูุณุฌูุงู ุงูุฏุฎูู
- โ ุชุณุฌูู ุงูุฎุฑูุฌ
- โ ุทูุจ ุชุณุฌูู ุฏุฎูู ุจุนุฏ ุงูุฎุฑูุฌ
- โ ููุณ ุงูุณููู ุนูู Android

---

## ๐ก ููุงุฆุฏ ุงูุฅุตูุงุญ

### ูููุณุชุฎุฏู:
- โ ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุณุฌูู ุงูุฏุฎูู ูู ูู ูุฑุฉ
- โ ุชุฌุฑุจุฉ ุงุณุชุฎุฏุงู ุฃูุถู
- โ ุชูููุฑ ุงูููุช

### ููุชุทุจูู:
- โ ุณููู ููุญุฏ ุนุจุฑ ุฌููุน ุงูููุตุงุช
- โ ุงุญุชุฑุงููุฉ ุฃูุจุฑ
- โ ุชูุงูู ูุน ูุนุงููุฑ ุงูุชุทุจููุงุช ุงูุญุฏูุซุฉ

---

## ๐ ุงูุชูุงูู ูุน ุงูููุฏ ุงูุญุงูู

### ุงูููุฏ ุงูููุฌูุฏ ูุนูู ุจุฏูู ุชุนุฏูู:

**`_checkAuthState()` ูู `main.dart`:**
```dart
final user = FirebaseAuth.instance.currentUser;
// โ ุงูุขู ูุนูุฏ ุงููุณุชุฎุฏู ุนูู Windows
```

**ุชุณุฌูู ุงูุฎุฑูุฌ ูู `admin_tabs_screen.dart`:**
```dart
await FirebaseAuth.instance.signOut();
// โ ูุนูู ุจุดูู ุตุญูุญ ูููุณุญ ุงูุฌูุณุฉ
```

---

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### ูุจู:
```
โ Windows: ุฅุนุงุฏุฉ ุชุณุฌูู ุฏุฎูู ูู ูู ูุฑุฉ
โ๏ธ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุฆุฉ
```

### ุจุนุฏ:
```
โ Windows: ุงูุจูุงุก ูุณุฌูุงู ุงูุฏุฎูู
โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ
โ ููุณ ุงูุณููู ุนูู ุฌููุน ุงูููุตุงุช
```

---

## ๐ ูุตุงุฏุฑ ุฅุถุงููุฉ

### Firebase Documentation:
- [Auth State Persistence](https://firebase.google.com/docs/auth/web/auth-state-persistence)
- [Firebase Auth for Flutter](https://firebase.google.com/docs/auth/flutter/start)

---

## ๐ ุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

### โ ูุง ุชุนูููุงู:

1. **Firebase Auth ูุญูุธ ุงูุฌูุณุฉ ุชููุงุฆูุงู** ุนูู ุฌููุน ุงูููุตุงุช
2. **`setPersistence()` ุฎุงุต ุจุงูู Web ููุท** - ูุง ุชุณุชุฎุฏูู ุนูู Mobile/Desktop
3. **`currentUser` ูุฏ ูููู null ูู ุงูุจุฏุงูุฉ** ุนูู Windows
4. **`authStateChanges().first` ูู ุงูุฃูุถู** ููุญุตูู ุนูู ุญุงูุฉ ููุซููุฉ
5. **ุฏุงุฆูุงู ุงุฎุชุจุฑ ุนูู ุงูููุตุฉ ุงููุณุชูุฏูุฉ** ูุจู ุฅุถุงูุฉ ููุฏ ุฌุฏูุฏ

### โ๏ธ ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ:

```dart
// โ ุฎุทุฃ 1: ุงุณุชุฎุฏุงู Web API ุนูู Desktop
await FirebaseAuth.instance.setPersistence(Persistence.LOCAL);

// โ ุฎุทุฃ 2: ุงูุงุนุชูุงุฏ ุนูู currentUser ูุจุงุดุฑุฉ
final user = FirebaseAuth.instance.currentUser;  // ูุฏ ูููู null

// โ ุตุญูุญ: ุงุณุชุฎุฏุงู authStateChanges
final user = await FirebaseAuth.instance.authStateChanges().first;
```

### ๐ฏ ูุชู ูุณุชุฎุฏู ูู APIุ

| ุงููููู | API ุงูููุงุณุจ |
|--------|-------------|
| **ูุญุต ุงููุณุชุฎุฏู ุนูุฏ ุจุฏุก ุงูุชุทุจูู** | `authStateChanges().first` โ |
| **ุงูุงุณุชูุงุน ูุชุบููุฑุงุช ุงูุญุงูุฉ** | `authStateChanges()` (Stream) |
| **ูุฑุงุกุฉ ุงููุณุชุฎุฏู ุฏุงุฎู Widget** | `currentUser` (ุจุนุฏ ุงูุชุฃูุฏ ูู ุงูุชุณุฌูู) |
| **Web ููุท** | `setPersistence()` |

### ๐ฏ ุงููุตูุญุฉ ุงูุฐูุจูุฉ:

**"Wait for Firebase to be Ready"**

ุนูู Windowsุ ุฏุงุฆูุงู ุงูุชุธุฑ Firebase ูุชุญููู ุงูุญุงูุฉ ูุจู ุงุชุฎุงุฐ ุงููุฑุงุฑ.

---

**ุงููุทูุฑ:** Cascade  
**ุงููุดุฑูุน:** ุชุทุจูู ูุฏุฑุณุฉ ุฏุงุฑ ุงูุณูุงู ููุจูุงุช  
**ุงูุฅุตูุงุญ:** ุญูุธ ุญุงูุฉ ุชุณุฌูู ุงูุฏุฎูู ุนูู Windows  
**ุงูุชุงุฑูุฎ:** 6 ููููุจุฑ 2025
