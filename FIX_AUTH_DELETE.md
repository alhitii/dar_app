# ๐ง ุญู ูุดููุฉ ุนุฏู ุญุฐู ุงูุญุณุงุจ ูู Authentication

**ุงูุชุงุฑูุฎ:** 30 ุฃูุชูุจุฑ 2025ุ 3:54 ุตุจุงุญุงู  
**ุงููุดููุฉ:** ุนูุฏ ุญุฐู ูุนูู/ุทุงูุจุ ููุญุฐู ูู Firestore ููู ูุจูู ูู Authentication  
**ุงูุณุจุจ:** Cloud Function ุบูุฑ ููุนูุฉ  
**ุงูุญู:** ุชูุจูู ุชููุงุฆู + ุฅุฑุดุงุฏุงุช ููุญุฐู ุงููุฏูู

---

## ๐จ **ุงููุดููุฉ:**

ุนูุฏ ุญุฐู ุญุณุงุจ ูุนูู ุฃู ุทุงูุจ:

```
โ ููุญุฐู ูู:
   - Firestore (users)
   - Firestore (teachers/students)
   - Firestore (users_emails)

โ ูุง ููุญุฐู ูู:
   - Firebase Authentication
```

**ุงููุชูุฌุฉ:**
- ุงูุญุณุงุจ ุบูุฑ ููุฌูุฏ ูู ุงูุชุทุจูู โ
- ููู ุงููุณุชุฎุฏู ูุง ุฒุงู ูุณุชุทูุน ุชุณุฌูู ุงูุฏุฎูู! โ

---

## ๐ **ุงูุณุจุจ:**

ุงูููุฏ ูุญุงูู ุงุณุชุฎุฏุงู Cloud Function:

```dart
final callable = FirebaseFunctions.instance
    .httpsCallable('deleteUserCompletely');
```

**ููู:**
- Cloud Function ุบูุฑ ููุฌูุฏุฉ/ููุนูุฉ โ
- ุงูููุฏ ููุดู ุจูุฏูุก ููุชุงุจุน โ
- ูุง ููุฌุฏ ุชูุจูู ูููุณุชุฎุฏู โ

---

## โ **ุงูุญู ุงููุทุจู:**

### **1. ุฅุถุงูุฉ ุชูุจูู ุชููุงุฆู**

```dart
// ูู user_management_service.dart

// ุจุนุฏ ุงูุญุฐู ูู Firestore
if (result['success'] == true && deletedUid != null) {
  result['warning'] = 'ุชู ุงูุญุฐู ูู Firestore ููุท...';
  result['authDeleteRequired'] = true;
  result['deletedEmail'] = email;
  result['deletedUid'] = deletedUid;
}
```

---

### **2. ุญูุงุฑ ุชูุงุนูู ูู ุงููุงุฌูุฉ**

```dart
// ูู dynamic_users_list.dart

if (result['authDeleteRequired'] == true) {
  _showAuthDeleteWarningDialog(
    email: result['deletedEmail'],
    uid: result['deletedUid'],
  );
}
```

**ุงูุญูุงุฑ ูุนุฑุถ:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ  ุชูุจูู ููู                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โ ุชู ุญุฐู ุงููุนูู ูู Firestore ุจูุฌุงุญ    โ
โ                                         โ
โ โ๏ธ ููู ุงูุญุณุงุจ ูุง ุฒุงู ููุฌูุฏุงู ูู        โ
โ    Authentication                       โ
โ                                         โ
โ ููุญุฐู ุงููุงูู:                          โ
โ 1. ุงูุชุญ Firebase Console               โ
โ 2. ุงุฐูุจ ุฅูู Authentication             โ
โ 3. ุงุจุญุซ ุนู: teacher@codeira.com       โ
โ    UID: abc123xyz                      โ
โ 4. ุงุญุฐู ุงูุญุณุงุจ ูุฏููุงู                  โ
โ                                         โ
โ โน๏ธ ุงูุณุจุจ: Cloud Function ุบูุฑ ููุนูุฉ    โ
โ                                         โ
โ    [ ูุณุฎ ุงูุจุฑูุฏ ]     [ ูููุช ]         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ **ููููุฉ ุงูุงุณุชุฎุฏุงู:**

### **ุงูุณููุงุฑูู: ุญุฐู ูุนูู**

```
1. Admin ููุชุญ "ูุงุฆูุฉ ุงููุนูููู"
2. ูุถุบุท ุนูู ุฃููููุฉ ุงูุญุฐู ๐๏ธ
3. ูุคูุฏ ุงูุญุฐู
4. โ ููุญุฐู ูู Firestore
5. โ๏ธ ูุธูุฑ ุญูุงุฑ ุงูุชูุจูู ุชููุงุฆูุงู
6. Admin ููุฑุฃ ุงูุชุนูููุงุช
7. ูุถุบุท "ูุณุฎ ุงูุจุฑูุฏ" (ุงุฎุชูุงุฑู)
8. ูุถุบุท "ูููุช"
9. ูุฐูุจ ูู Firebase Console
10. ูุญุฐู ุงูุญุณุงุจ ูุฏููุงู ูู Authentication
```

---

## ๐ **ูุจู ูุจุนุฏ:**

### **ูุจู ุงูุญู:**
```
Admin ูุญุฐู ูุนูู
โ
โ ุญูุฐู ูู Firestore
โ
โ ูุง ูุนูู Admin ุฃู ุงูุญุณุงุจ ูุง ุฒุงู ูู Authentication
โ
ุงููุนูู ูุณุชุทูุน ุชุณุฌูู ุงูุฏุฎูู! โ
```

---

### **ุจุนุฏ ุงูุญู:**
```
Admin ูุญุฐู ูุนูู
โ
โ ุญูุฐู ูู Firestore
โ
โ๏ธ ุญูุงุฑ ุชูุจูู ูุธูุฑ ุชููุงุฆูุงู
โ
Admin ููุฑุฃ ุงูุชุนูููุงุช
โ
Admin ูุญุฐู ูู Authentication ูุฏููุงู
โ
โ ุงูุญุฐู ูุงูู!
```

---

## ๐ง **ุงูุฎุทูุงุช ุงููุฏููุฉ ููุญุฐู ูู Authentication:**

### **1. ุงูุชุญ Firebase Console**
```
https://console.firebase.google.com/
```

### **2. ุงุฎุชุฑ ุงููุดุฑูุน**
```
Madrasah Dar Al Salam for Girls
```

### **3. ุงุฐูุจ ูู Authentication**
```
ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ โ Build โ Authentication โ Users
```

### **4. ุงุจุญุซ ุนู ุงููุณุชุฎุฏู**
```
ุงุณุชุฎุฏู ุดุฑูุท ุงูุจุญุซ:
- ุงูุชุจ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- ุฃู ุงูู UID
```

### **5. ุงุญุฐู ุงูุญุณุงุจ**
```
ุงุถุบุท ุนูู โฎ (ุซูุงุซ ููุงุท) ุจุฌุงูุจ ุงูุญุณุงุจ
โ Delete account
โ ุฃูุฏ ุงูุญุฐู
```

---

## ๐ก **ุงูุญู ุงูุจุฏูู: Cloud Function**

ุฅุฐุง ุฃุฑุฏุช ุญุฐูุงู ุชููุงุฆูุงู ูุงููุงูุ ูุฌุจ ุฅูุดุงุก Cloud Function:

### **ุงูุฎุทูุงุช:**

#### **1. ุฅูุดุงุก ุงูููู**
```bash
# ูู ูุฌูุฏ functions/src
touch deleteUserCompletely.ts
```

#### **2. ุงูููุฏ:**
```typescript
import * as functions from 'firebase-functions';
import * as admin from 'firebase-admin';

export const deleteUserCompletely = functions.https.onCall(
  async (data, context) => {
    // ุชุญูู ูู ุงูุตูุงุญูุงุช
    if (!context.auth || context.auth.token.role !== 'admin') {
      throw new functions.https.HttpsError(
        'permission-denied',
        'Only admins can delete users'
      );
    }

    const { uid } = data;

    try {
      // 1. ุญุฐู ูู Authentication
      await admin.auth().deleteUser(uid);

      // 2. ุญุฐู ูู Firestore (ูุญุฏุซ ุชููุงุฆูุงู ุนุจุฑ ุงูููุฏ ุงูุญุงูู)

      return {
        success: true,
        message: 'User deleted from Authentication',
      };
    } catch (error) {
      console.error('Error deleting user:', error);
      throw new functions.https.HttpsError(
        'internal',
        'Failed to delete user'
      );
    }
  }
);
```

#### **3. ุงููุดุฑ:**
```bash
firebase deploy --only functions:deleteUserCompletely
```

#### **4. ุฅุถุงูุฉ Custom Claims ููู Admin:**
```typescript
// ุนูุฏ ุฅูุดุงุก Admin
await admin.auth().setCustomUserClaims(adminUid, { role: 'admin' });
```

---

## โ **ุงูููุงุฆุฏ:**

### **ุงูุญู ุงูุญุงูู (ุงูุชูุจูู):**
- โ **ุณุฑูุน:** ูุง ูุญุชุงุฌ Cloud Function
- โ **ูุงุถุญ:** ุงููุณุชุฎุฏู ูุนุฑู ุงููุดููุฉ
- โ **ุขูู:** ุงูุญุฐู ุงููุฏูู ูููุน ุงูุฃุฎุทุงุก
- โ **ูุฌุงูู:** ูุง ุชูููุฉ Cloud Functions

### **ุงูุญู ุงููุซุงูู (Cloud Function):**
- โ **ุชููุงุฆู:** ุญุฐู ูุงูู ุจุถุบุทุฉ ูุงุญุฏุฉ
- โ **ุณูุณ:** ุชุฌุฑุจุฉ ุฃูุถู
- โ **ูุนูุฏ:** ูุญุชุงุฌ ุฅุนุฏุงุฏ
- โ **ุชูููุฉ:** Cloud Functions ูุฏููุนุฉ

---

## ๐งช **ุงูุงุฎุชุจุงุฑ:**

### **ุงุฎุชุจุฑ ุงูุญู:**

```bash
# ุดุบูู ุงูุชุทุจูู
flutter run -d windows

# ุซู:
1. ุณุฌู ุฏุฎูู ูู Admin
2. ุงูุชุญ "ูุงุฆูุฉ ุงููุนูููู"
3. ุงุฎุชุฑ ูุนูู ุชุฌุฑูุจู
4. ุงุถุบุท ๐๏ธ (ุญุฐู)
5. ุฃูุฏ ุงูุญุฐู

ูุฌุจ ุฃู ุชุฑู:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ  ุชูุจูู ููู                      โ
โ                                    โ
โ โ ุชู ุญุฐู ุงููุนูู ูู Firestore      โ
โ โ๏ธ ููู ุงูุญุณุงุจ ูุง ุฒุงู ูู Auth      โ
โ                                    โ
โ ุชุนูููุงุช ุงูุญุฐู ุงููุฏูู...           โ
โ                                    โ
โ  [ ูุณุฎ ุงูุจุฑูุฏ ]    [ ูููุช ]       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ **ุงููููุงุช ุงููุนุฏูุฉ:**

### **1. user_management_service.dart**
```
ุงูุชุนุฏูู: ุฅุถุงูุฉ ุญููู ุงูุชูุจูู ูู ุงููุชูุฌุฉ
ุงููุธููุฉ: ุฅุนูุงู ุงููุงุฌูุฉ ุจุงูุญุงุฌุฉ ููุญุฐู ุงููุฏูู
```

### **2. dynamic_users_list.dart**
```
ุงูุชุนุฏูู: ุฅุถุงูุฉ ุญูุงุฑ ุงูุชูุจูู
ุงููุธููุฉ: ุนุฑุถ ุงูุชุนูููุงุช ูููุณุชุฎุฏู
```

---

## ๐ฏ **ุงูุฎูุงุตุฉ:**

**ุงููุดููุฉ:**
- โ ุงูุญุณุงุจ ูุจูู ูู Authentication ุจุนุฏ ุงูุญุฐู

**ุงูุณุจุจ:**
- โ Cloud Function ุบูุฑ ูุชููุฑุฉ

**ุงูุญู:**
- โ ุชูุจูู ุชููุงุฆู ูุน ุชุนูููุงุช
- โ ุฒุฑ ูุณุฎ ุงูุจุฑูุฏ
- โ ูุงุฌูุฉ ูุงุถุญุฉ

**ุงููุชูุฌุฉ:**
- ๐ฏ Admin ูุนุฑู ุงููุดููุฉ
- ๐ Admin ูุนุฑู ููู ูุญููุง
- โ ุญุฐู ูุงูู ูุขูู

---

## ๐ **ููุงุญุธุงุช ูููุฉ:**

### **1. ูุชู ูุญุชุงุฌ ุงูุญุฐู ุงููุฏููุ**
```
โ ุฏุงุฆูุงู (ุญุชู ูุชู ุชูุนูู Cloud Function)
```

### **2. ูู ูุคุซุฑ ุนูู ุงูุชุทุจููุ**
```
โ ูุงุ ุงูุญุณุงุจ ูุญุฐูู ูู Firestore
โ ุงูุชุทุจูู ูู ูุนุฑุถ ุงููุณุชุฎุฏู
โ๏ธ ููู ููููู ุชุณุฌูู ุงูุฏุฎูู ูู Authentication
```

### **3. ูุงุฐุง ูู ูู ุฃุญุฐู ูู Authenticationุ**
```
โ๏ธ ุงููุณุชุฎุฏู ูุณุชุทูุน ุชุณุฌูู ุงูุฏุฎูู
โ๏ธ ููู ูู ูุฌุฏ ุจูุงูุงุชู ูู Firestore
โ๏ธ ุณูุฑู ุดุงุดุฉ ุฎุทุฃ
```

---

**โ ุงูุญู ุฌุงูุฒ! ุงุฎุชุจุฑู ุงูุขู**

**ุขุฎุฑ ุชุญุฏูุซ:** 30 ุฃูุชูุจุฑ 2025ุ 3:54 ุตุจุงุญุงู
