# ๐ ููุฎุต ูุธุงู ุงูุชูุณูุน ุงููุคูุช ููุตูุงุญูุงุช

## โ ูุง ุชู ุฅูุดุงุคู

| ุงูููู | ุงูููุน | ุงููุตู |
|------|------|-------|
| `lib/services/temporary_scope_expansion_service.dart` | โจ Service | ุงูุณูุฑุจุชุงุช ุงูุฃุณุงุณูุฉ |
| `lib/ui/admin/temporary_scope_manager.dart` | โจ UI | ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ |
| `firestore_security_rules_temporary_scopes.txt` | ๐ Rules | ููุงุนุฏ ุงูุฃูุงู |
| `TEMPORARY_SCOPE_EXPANSION_GUIDE.md` | ๐ Docs | ุฏููู ุดุงูู |
| `QUICK_START_TEMPORARY_SCOPES.md` | ๐ Docs | ุฏููู ุณุฑูุน |
| `TEMPORARY_SCOPES_SUMMARY.md` | ๐ Docs | ูุฐุง ุงูููู |

---

## ๐ฏ ุงููุธุงุฆู ุงููุชุงุญุฉ

### **1. ุฎุฏูุฉ ุงูุชูุณูุน (TemporaryScopeExpansionService)**

```dart
// ุชูุณูุน ุงูุตูุงุญูุงุช
static Future<Map<String, dynamic>> expandScopesTemporarily()

// ุงุณุชุฑุฌุงุน ุงูุตูุงุญูุงุช
static Future<Map<String, dynamic>> rollbackTeacherScopes()

// ุญุฐู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
static Future<Map<String, dynamic>> cleanupBackups()

// ุงูุญุตูู ุนูู ุญุงูุฉ ุงููุธุงู
static Future<Map<String, dynamic>> getSystemStatus()
```

### **2. ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ (TemporaryScopeManager)**

- โ ุชูุนูู/ุชุนุทูู Feature Flag
- โ ุนุฑุถ ุญุงูุฉ ุงููุธุงู
- โ ุชูุณูุน ุงูุตูุงุญูุงุช
- โ ุงุณุชุฑุฌุงุน ุงูุตูุงุญูุงุช
- โ ุชุญุฏูุซ ุงูุญุงูุฉ
- โ ุญุฐู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### **Collections ูู Firestore:**

```
users/
โโโ {teacherId}/
โ   โโโ subjects: [...]
โ   โโโ classes: [...]
โ   โโโ sections: [...]
โ   โโโ scopesTemporary: true/false

users_emails/
โโโ {email}/
โ   โโโ subjects: [...]
โ   โโโ classes: [...]
โ   โโโ sections: [...]
โ   โโโ scopesTemporary: true/false

backups_users/
โโโ {teacherId}/
โ   โโโ subjects: [original]
โ   โโโ classes: [original]
โ   โโโ sections: [original]
โ   โโโ backedUpAt: timestamp

settings/
โโโ features/
    โโโ autoTestAllScopes: true/false

logs/
โโโ {logId}/
    โโโ operation: "expandScopes" | "rollbackScopes"
    โโโ data: {...}
    โโโ timestamp: ...
```

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

```
1. ุชูุนูู Feature Flag
   โ
2. ุชูุณูุน ุงูุตูุงุญูุงุช
   โโโ ูุณุฎ ุงุญุชูุงุทู
   โโโ ุชูุณูุน subjects/classes/sections
   โโโ ุชุนููู scopesTemporary = true
   โ
3. ุงูุงุฎุชุจุงุฑ
   โโโ ุณุฌูู ุฏุฎูู ููุนูู
   โโโ ุดุงูุฏ ุฌููุน ุงูููุงุฏ/ุงูุตููู/ุงูุดุนุจ
   โโโ ุฃุฑุณู ูุงุฌุจุงุช ุชุฌุฑูุจูุฉ
   โ
4. ุงุณุชุฑุฌุงุน ุงูุตูุงุญูุงุช
   โโโ ูุฑุงุกุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
   โโโ ุงุณุชุฑุฌุงุน subjects/classes/sections ุงูุฃุตููุฉ
   โโโ ุญุฐู scopesTemporary
   โ
5. (ุงุฎุชูุงุฑู) ุญุฐู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ุงููุชููุนุฉ

### **ูููุดุฑูุน ุงูุญุงูู (ุชูุฏูุฑู):**

```
ุนุฏุฏ ุงููุนูููู: ~20
ุนุฏุฏ ุงูููุงุฏ: ~10
ุนุฏุฏ ุงูุตููู: ~9
ุนุฏุฏ ุงูุดุนุจ: ~6

ููุช ุงูุชูุณูุน: ~30-60 ุซุงููุฉ
ููุช ุงูุงุณุชุฑุฌุงุน: ~20-40 ุซุงููุฉ
ุญุฌู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ: ~10-20 KB
```

---

## ๐ ุงูุฃูุงู

### **ููุงุนุฏ Firestore:**

| Collection | ุงููุฑุงุกุฉ | ุงููุชุงุจุฉ |
|-----------|---------|---------|
| `backups_users` | ุฅุฏุงุฑุฉ ููุท | ุฅุฏุงุฑุฉ ููุท |
| `logs` | ุฅุฏุงุฑุฉ ููุท | ุงููู (create) |
| `settings/features` | ุงููู | ุฅุฏุงุฑุฉ ููุท |
| `users` | ุงููู | ุฅุฏุงุฑุฉ ููุท |

### **ุงูุญูุงูุฉ:**

- โ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ูุญููุฉ ูู ุงููุฑุงุกุฉ ุงูุนุงูุฉ
- โ ุงูุณุฌูุงุช ูุง ูููู ุชุนุฏูููุง ุฃู ุญุฐููุง
- โ Feature Flags ูุญููุฉ ูู ุงูุชุนุฏูู ุงูุนุงู
- โ ุชุญูู ูู ุงูุตูุงุญูุงุช ูู ูู ุนูููุฉ

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### **ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ:**

| ุงูุณููุงุฑูู | ุงูุญุงูุฉ |
|----------|--------|
| ุชูุณูุน ุงูุตูุงุญูุงุช | โ ุฌุงูุฒ |
| ุฅุฑุณุงู ูุงุฌุจ ุจูุงุฏุฉ ุฌุฏูุฏุฉ | โ ุฌุงูุฒ |
| ุฅุฑุณุงู ูุงุฌุจ ูุตู ุฌุฏูุฏ | โ ุฌุงูุฒ |
| ุฅุฑุณุงู ูุงุฌุจ ูุดุนุจุฉ ุฌุฏูุฏุฉ | โ ุฌุงูุฒ |
| ุงุณุชุฑุฌุงุน ุงูุตูุงุญูุงุช | โ ุฌุงูุฒ |
| ุงูุชุญูู ูู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ | โ ุฌุงูุฒ |
| ุญุฐู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ | โ ุฌุงูุฒ |

### **ุงูุชุญูู ูู ุงููุชุงุฆุฌ:**

```dart
// ูุจู ุงูุชูุณูุน
final before = await _firestore.collection('users').doc(teacherId).get();
print('ูุจู: ${before.data()!['subjects']}');

// ุชูุณูุน
await TemporaryScopeExpansionService.expandScopesTemporarily();

// ุจุนุฏ ุงูุชูุณูุน
final after = await _firestore.collection('users').doc(teacherId).get();
print('ุจุนุฏ: ${after.data()!['subjects']}');
// ุงููุชูุฌุฉ: ุฌููุน ุงูููุงุฏ

// ุงุณุชุฑุฌุงุน
await TemporaryScopeExpansionService.rollbackTeacherScopes();

// ุจุนุฏ ุงูุงุณุชุฑุฌุงุน
final restored = await _firestore.collection('users').doc(teacherId).get();
print('ูุณุชุฑุฌุน: ${restored.data()!['subjects']}');
// ุงููุชูุฌุฉ: ููุณ "ูุจู"
```

---

## ๐ ูุนุงููุฑ ุงูุฃุฏุงุก

### **ุงูุฃูุฏุงู:**

- โฑ๏ธ ุงูุชูุณูุน: < 2 ุฏูููุฉ (ูู 50 ูุนูู)
- โฑ๏ธ ุงูุงุณุชุฑุฌุงุน: < 1 ุฏูููุฉ (ูู 50 ูุนูู)
- โ ูุณุจุฉ ุงููุฌุงุญ: > 99%
- ๐ Logging: 100% ูู ุงูุนูููุงุช

### **ุงูุชุญุณููุงุช ุงููุทุจูุฉ:**

- โ Batching ูู 10 ุนูููุงุช
- โ ุชุฃุฎูุฑ 500ms ุจูู ุงูุฏูุนุงุช
- โ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ููู ูุนูู
- โ ุชุณุฌูู ุดุงูู

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### **ูููุณุชุฎุฏู ุงูููุงุฆู (ุงูุฅุฏุงุฑุฉ):**

```
1. ุงูุชุญ "ุฅุฏุงุฑุฉ ุงูุงุฎุชุจุงุฑ ุงููุคูุช"
2. ูุนูู "ูุถุน ุงูุงุฎุชุจุงุฑ ุงูุดุงูู"
3. ุงุถุบุท "ุชูุณูุน ุงูุตูุงุญูุงุช"
4. ุงูุชุธุฑ ุงูุฅุดุนุงุฑ
5. ุฌุฑูุจ ููุนูู
6. ุงุถุบุท "ุงุณุชุฑุฌุงุน ุงูุตูุงุญูุงุช"
7. ุชุญูู ูู ุงููุชุงุฆุฌ
```

### **ูููุทูุฑ:**

```dart
import 'package:madrasah/services/temporary_scope_expansion_service.dart';

// ุงุณุชุฎุฏุงู ูุจุงุดุฑ
void testExpansion() async {
  // ุชูุณูุน
  final result = await TemporaryScopeExpansionService.expandScopesTemporarily();
  print('ูุฌุญ: ${result['successCount']} / ${result['totalTeachers']}');
  
  // ุงุฎุชุจุงุฑ...
  
  // ุงุณุชุฑุฌุงุน
  await TemporaryScopeExpansionService.rollbackTeacherScopes();
}
```

---

## โ๏ธ ุชุญุฐูุฑุงุช ูููุฉ

### **ุงุณุชุฎุฏุงู ุขูู:**

```
โ ุจูุฆุฉ ุงูุชุทููุฑ
โ ุจูุฆุฉ ุงูุงุฎุชุจุงุฑ
โ๏ธ ุจูุฆุฉ ุงูุฅูุชุงุฌ (ุจุญุฐุฑ ุดุฏูุฏ)
โ ุจุฏูู ูุณุฎ ุงุญุชูุงุทู ุฎุงุฑุฌู
```

### **ูุจู ุงูุฅูุชุงุฌ:**

- [ ] ุงุฎุชุจุงุฑ ูุงูู ูู ุจูุฆุฉ ุงูุชุทููุฑ
- [ ] ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุฎุงุฑุฌูุฉ ูู Firestore
- [ ] ุฎุทุฉ ุทูุงุฑุฆ ููุงุณุชุฑุฌุงุน ุงููุฏูู
- [ ] ุชุฏุฑูุจ ูุฑูู ุงูุฏุนู
- [ ] ุชูุซูู ุงูุนูููุงุช
- [ ] ููุงููุฉ ุงููุฏูุฑ ุงูููู

---

## ๐ ุงูุฏุนู ูุญู ุงููุดุงูู

### **ุงูููุงุฑุฏ:**

- ๐ `TEMPORARY_SCOPE_EXPANSION_GUIDE.md` - ุฏููู ุดุงูู
- ๐ `QUICK_START_TEMPORARY_SCOPES.md` - ุจุฏุก ุณุฑูุน
- ๐ `logs` collection - ุณุฌูุงุช ุงูุนูููุงุช
- ๐ `firestore_security_rules_temporary_scopes.txt` - ููุงุนุฏ ุงูุฃูุงู

### **ุงูุงุชุตุงู:**

```
ูููุดุงูู ุงูุชูููุฉ: ุฑุงุฌุน logs collection
ููุฃุฎุทุงุก: ุงูุญุต Console ูู ุงูุชุทุจูู
ููุทูุงุฑุฆ: ุงุณุชุฑุฌุงุน ูุฏูู ูู backups_users
```

---

## ๐ฏ ุงูุฎูุงุตุฉ

### **ุชู ุฅูุฌุงุฒู:**

- โ ูุธุงู ูุงูู ููุชูุณูุน ุงููุคูุช
- โ ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุณููุฉ
- โ ูุณุฎ ุงุญุชูุงุทูุฉ ุขููุฉ
- โ ุงุณุชุฑุฌุงุน ูุงูู
- โ Logging ุดุงูู
- โ ููุงุนุฏ ุฃูุงู ูุญููุฉ
- โ ุชูุซูู ูุงูู

### **ุงูุฌุงูุฒูุฉ:**

```
๐ข ุฌุงูุฒ ููุงุฎุชุจุงุฑ ูู ุจูุฆุฉ ุงูุชุทููุฑ
๐ก ูุญุชุงุฌ ูุฑุงุฌุนุฉ ูุจู ุงูุฅูุชุงุฌ
๐ด ูุง ุชุณุชุฎุฏู ุจุฏูู ูุณุฎ ุงุญุชูุงุทู
```

---

## ๐ ุงููููุงุช ูููุฑุงุฌุนุฉ

1. **ููุชุทููุฑ:**
   - `lib/services/temporary_scope_expansion_service.dart`
   - `lib/ui/admin/temporary_scope_manager.dart`

2. **ูููุดุฑ:**
   - `firestore_security_rules_temporary_scopes.txt`

3. **ููุชูุซูู:**
   - `TEMPORARY_SCOPE_EXPANSION_GUIDE.md`
   - `QUICK_START_TEMPORARY_SCOPES.md`
   - `TEMPORARY_SCOPES_SUMMARY.md`

---

**โ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-01-25
**ุงูุญุงูุฉ:** โ Complete and Ready
**ุงูุฅุตุฏุงุฑ:** 1.0.0
